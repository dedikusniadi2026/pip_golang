
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>handler: Go Coverage Report</title>
		<style>
			body {
				background: black;
				color: rgb(80, 80, 80);
			}
			body, pre, #legend span {
				font-family: Menlo, monospace;
				font-weight: bold;
			}
			#topbar {
				background: black;
				position: fixed;
				top: 0; left: 0; right: 0;
				height: 42px;
				border-bottom: 1px solid rgb(80, 80, 80);
			}
			#content {
				margin-top: 50px;
			}
			#nav, #legend {
				float: left;
				margin-left: 10px;
			}
			#legend {
				margin-top: 12px;
			}
			#nav {
				margin-top: 10px;
			}
			#legend span {
				margin: 0 5px;
			}
			.cov0 { color: rgb(192, 0, 0) }
.cov1 { color: rgb(128, 128, 128) }
.cov2 { color: rgb(116, 140, 131) }
.cov3 { color: rgb(104, 152, 134) }
.cov4 { color: rgb(92, 164, 137) }
.cov5 { color: rgb(80, 176, 140) }
.cov6 { color: rgb(68, 188, 143) }
.cov7 { color: rgb(56, 200, 146) }
.cov8 { color: rgb(44, 212, 149) }
.cov9 { color: rgb(32, 224, 152) }
.cov10 { color: rgb(20, 236, 155) }

		</style>
	</head>
	<body>
		<div id="topbar">
			<div id="nav">
				<select id="files">
				
				<option value="file0">auth-service/handler/assignment_handler.go (93.8%)</option>
				
				<option value="file1">auth-service/handler/auth.go (100.0%)</option>
				
				<option value="file2">auth-service/handler/booking_handler.go (86.2%)</option>
				
				<option value="file3">auth-service/handler/bookingtrend_handler.go (100.0%)</option>
				
				<option value="file4">auth-service/handler/car_handler.go (89.2%)</option>
				
				<option value="file5">auth-service/handler/car_model_handler.go (88.9%)</option>
				
				<option value="file6">auth-service/handler/car_type_handler.go (81.5%)</option>
				
				<option value="file7">auth-service/handler/chart_handler.go (100.0%)</option>
				
				<option value="file8">auth-service/handler/dashboardTrip_handler.go (100.0%)</option>
				
				<option value="file9">auth-service/handler/dashboard_handler.go (100.0%)</option>
				
				<option value="file10">auth-service/handler/driver_handler.go (94.4%)</option>
				
				<option value="file11">auth-service/handler/maintenance_handler.go (100.0%)</option>
				
				<option value="file12">auth-service/handler/payment_handler.go (90.8%)</option>
				
				<option value="file13">auth-service/handler/pdf_handler.go (100.0%)</option>
				
				<option value="file14">auth-service/handler/trip_handler.go (95.7%)</option>
				
				<option value="file15">auth-service/handler/trip_history_handler.go (100.0%)</option>
				
				<option value="file16">auth-service/main.go (0.0%)</option>
				
				<option value="file17">auth-service/model/user.go (100.0%)</option>
				
				<option value="file18">auth-service/repository/assignment_repository.go (91.3%)</option>
				
				<option value="file19">auth-service/repository/booking_repository.go (96.4%)</option>
				
				<option value="file20">auth-service/repository/bookingtrend_repository.go (91.7%)</option>
				
				<option value="file21">auth-service/repository/car_model_repository.go (95.2%)</option>
				
				<option value="file22">auth-service/repository/car_repository.go (96.2%)</option>
				
				<option value="file23">auth-service/repository/car_type_repository.go (95.2%)</option>
				
				<option value="file24">auth-service/repository/chart_repository.go (94.7%)</option>
				
				<option value="file25">auth-service/repository/dashboardTrip_repository.go (100.0%)</option>
				
				<option value="file26">auth-service/repository/dashboard_repository.go (100.0%)</option>
				
				<option value="file27">auth-service/repository/driver_repository.go (92.3%)</option>
				
				<option value="file28">auth-service/repository/maintenance_repository.go (95.5%)</option>
				
				<option value="file29">auth-service/repository/payment_repository.go (90.7%)</option>
				
				<option value="file30">auth-service/repository/pdf_repository.go (100.0%)</option>
				
				<option value="file31">auth-service/repository/trip_history_repository.go (87.5%)</option>
				
				<option value="file32">auth-service/repository/trip_repository.go (87.0%)</option>
				
				<option value="file33">auth-service/repository/user_repo.go (100.0%)</option>
				
				<option value="file34">auth-service/server.go (100.0%)</option>
				
				<option value="file35">auth-service/service/assignment_service.go (100.0%)</option>
				
				<option value="file36">auth-service/service/auth_service.go (90.9%)</option>
				
				<option value="file37">auth-service/service/booking_service.go (100.0%)</option>
				
				<option value="file38">auth-service/service/bookingtrend_service.go (100.0%)</option>
				
				<option value="file39">auth-service/service/car_model_service.go (100.0%)</option>
				
				<option value="file40">auth-service/service/car_service.go (100.0%)</option>
				
				<option value="file41">auth-service/service/car_type_service.go (100.0%)</option>
				
				<option value="file42">auth-service/service/chart_service.go (100.0%)</option>
				
				<option value="file43">auth-service/service/dashboardTrip_service.go (100.0%)</option>
				
				<option value="file44">auth-service/service/dashboard_service.go (72.7%)</option>
				
				<option value="file45">auth-service/service/driver_service.go (100.0%)</option>
				
				<option value="file46">auth-service/service/maintenance_service.go (100.0%)</option>
				
				<option value="file47">auth-service/service/payment_service.go (87.5%)</option>
				
				<option value="file48">auth-service/service/pdf_service.go (60.0%)</option>
				
				<option value="file49">auth-service/service/trip_service.go (0.0%)</option>
				
				<option value="file50">auth-service/service/triphistory_service.go (66.7%)</option>
				
				</select>
			</div>
			<div id="legend">
				<span>not tracked</span>
			
				<span class="cov0">not covered</span>
				<span class="cov8">covered</span>
			
			</div>
		</div>
		<div id="content">
		
		<pre class="file" id="file0" style="display: none">package handler

import (
        "auth-service/model"
        "auth-service/service"
        "net/http"
        "strconv"

        "github.com/gin-gonic/gin"
)

type AssignmentHandler struct {
        service service.AssignmentsServiceInterface
}

func NewAssignmentHandler(s service.AssignmentsServiceInterface) *AssignmentHandler <span class="cov8" title="1">{
        return &amp;AssignmentHandler{service: s}
}</span>

func (h *AssignmentHandler) Create(c *gin.Context) <span class="cov8" title="1">{
        var a model.DriverAssignment
        if err := c.ShouldBindJSON(&amp;a); err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov8" title="1">if err := h.service.Create(&amp;a); err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov8" title="1">c.JSON(http.StatusCreated, a)</span>
}

func (h *AssignmentHandler) FindByVehicle(c *gin.Context) <span class="cov8" title="1">{
        vehicleIDStr := c.Param("vehicle_id")

        vehicleID, err := strconv.Atoi(vehicleIDStr)
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusBadRequest, gin.H{"error": "invalid vehicle_id"})
                return
        }</span>

        <span class="cov8" title="1">data, err := h.service.FindByVehicle(uint(vehicleID))
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">c.JSON(http.StatusOK, data)</span>
}

func (h *AssignmentHandler) Update(c *gin.Context) <span class="cov8" title="1">{
        var a model.DriverAssignment
        if err := c.ShouldBindJSON(&amp;a); err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov8" title="1">if err := h.service.Update(&amp;a); err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov8" title="1">c.JSON(http.StatusOK, a)</span>
}

func (h *AssignmentHandler) Delete(c *gin.Context) <span class="cov8" title="1">{
        id, _ := strconv.Atoi(c.Param("id"))
        if err := h.service.Delete(uint(id)); err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov8" title="1">c.JSON(http.StatusOK, gin.H{"message": "deleted"})</span>
}
</pre>
		
		<pre class="file" id="file1" style="display: none">package handler

import (
        "net/http"

        "auth-service/service"

        "github.com/gin-gonic/gin"
)

type AuthHandler struct {
        AuthService *service.AuthService
}

func (h *AuthHandler) Login(c *gin.Context) <span class="cov8" title="1">{
        c.JSON(http.StatusOK, gin.H{"message": "Login successful"})
}</span>

func (h *AuthHandler) Refresh(c *gin.Context) <span class="cov8" title="1">{
        c.JSON(http.StatusOK, gin.H{"message": "Token refreshed"})
}</span>
</pre>
		
		<pre class="file" id="file2" style="display: none">package handler

import (
        "auth-service/model"
        "auth-service/service"
        "net/http"

        "github.com/gin-gonic/gin"
)

type BookingRepoInterface interface {
        Create(*model.Booking) error
        GetAll() ([]model.Booking, error)
        Update(*model.Booking) error
        Delete(id string) error
}

type BookingHandler struct {
        BookingService service.BookingServiceInterface
}

func NewBookingHandler(s service.BookingServiceInterface) *BookingHandler <span class="cov8" title="1">{
        return &amp;BookingHandler{BookingService: s}
}</span>

func (h *BookingHandler) Create(c *gin.Context) <span class="cov8" title="1">{
        var booking model.Booking
        if err := c.ShouldBindJSON(&amp;booking); err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov8" title="1">if err := h.BookingService.Create(&amp;booking); err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov8" title="1">c.JSON(http.StatusCreated, booking)</span>
}

func (h *BookingHandler) GetAll(c *gin.Context) <span class="cov8" title="1">{
        bookings, err := h.BookingService.GetAll()
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov8" title="1">c.JSON(http.StatusOK, bookings)</span>
}
func (h *BookingHandler) Update(c *gin.Context) <span class="cov8" title="1">{
        id := c.Param("id")

        var booking model.Booking
        if err := c.ShouldBindJSON(&amp;booking); err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">booking.ID = id
        if err := h.BookingService.Update(&amp;booking); err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">c.JSON(http.StatusOK, booking)</span>
}

func (h *BookingHandler) Delete(c *gin.Context) <span class="cov8" title="1">{
        id := c.Param("id")

        if err := h.BookingService.Delete(id); err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">c.JSON(http.StatusOK, gin.H{"message": "Booking deleted successfully"})</span>
}
</pre>
		
		<pre class="file" id="file3" style="display: none">package handler

import (
        "auth-service/model"
        "net/http"
        "strconv"

        "github.com/gin-gonic/gin"
)

type BookingTrendsServiceInterface interface {
        GetTrends(year int) ([]model.BookingTrend, error)
}

type BookingTrendsHandler struct {
        Service BookingTrendsServiceInterface
}

func NewBookingTrendsHandler(s BookingTrendsServiceInterface) *BookingTrendsHandler <span class="cov8" title="1">{
        return &amp;BookingTrendsHandler{Service: s}
}</span>

func (h *BookingTrendsHandler) GetTrends(c *gin.Context) <span class="cov8" title="1">{
        yearStr := c.DefaultQuery("year", "2024")
        year, _ := strconv.Atoi(yearStr)

        data, err := h.Service.GetTrends(year)
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">var months []string
        var bookings []int

        for _, d := range data </span><span class="cov8" title="1">{
                months = append(months, d.Month)
                bookings = append(bookings, d.Booking)
        }</span>

        <span class="cov8" title="1">c.JSON(http.StatusOK, gin.H{
                "months":   months,
                "bookings": bookings,
        })</span>
}
</pre>
		
		<pre class="file" id="file4" style="display: none">package handler

import (
        "net/http"
        "strconv"

        "auth-service/model"

        "github.com/gin-gonic/gin"
)

type CarServiceInterface interface {
        GetAll() ([]model.Car, error)
        GetByID(int) (*model.Car, error)
        Create(model.Car) error
        Update(int, model.Car) error
        Delete(int) error
}

type CarHandler struct {
        Service CarServiceInterface
}

func NewCarHandler(service CarServiceInterface) *CarHandler <span class="cov8" title="1">{
        return &amp;CarHandler{Service: service}
}</span>

func (h *CarHandler) GetAll(c *gin.Context) <span class="cov8" title="1">{
        data, err := h.Service.GetAll()
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov8" title="1">c.JSON(http.StatusOK, data)</span>
}

func (h *CarHandler) GetByID(c *gin.Context) <span class="cov8" title="1">{
        id, _ := strconv.Atoi(c.Param("id"))
        v, err := h.Service.GetByID(id)
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov8" title="1">if v == nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusNotFound, gin.H{"error": "Car not found"})
                return
        }</span>
        <span class="cov8" title="1">c.JSON(http.StatusOK, v)</span>
}

func (h *CarHandler) Create(c *gin.Context) <span class="cov8" title="1">{
        var v model.Car
        if err := c.ShouldBindJSON(&amp;v); err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">if err := h.Service.Create(v); err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">c.JSON(http.StatusCreated, gin.H{"message": "Car created"})</span>
}

func (h *CarHandler) Update(c *gin.Context) <span class="cov8" title="1">{
        id, _ := strconv.Atoi(c.Param("id"))

        var v model.Car
        if err := c.ShouldBindJSON(&amp;v); err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">if err := h.Service.Update(id, v); err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">c.JSON(http.StatusOK, gin.H{"message": "Car updated"})</span>
}

func (h *CarHandler) Delete(c *gin.Context) <span class="cov8" title="1">{
        id, _ := strconv.Atoi(c.Param("id"))

        if err := h.Service.Delete(id); err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">c.JSON(http.StatusOK, gin.H{"message": "Car deleted"})</span>
}
</pre>
		
		<pre class="file" id="file5" style="display: none">package handler

import (
        "auth-service/model"
        "net/http"
        "strconv"

        "github.com/gin-gonic/gin"
)

type CarModelServiceInterface interface {
        GetAll() ([]model.CarModel, error)
        GetByID(int) (*model.CarModel, error)
        Create(model.CarModel) error
}

type CarModelHandler struct {
        Service CarModelServiceInterface
}

func NewCarModelRepositoryHandler(service CarModelServiceInterface) *CarModelHandler <span class="cov0" title="0">{
        return &amp;CarModelHandler{Service: service}
}</span>

func (h *CarModelHandler) GetAll(c *gin.Context) <span class="cov8" title="1">{
        data, err := h.Service.GetAll()
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov8" title="1">c.JSON(http.StatusOK, data)</span>
}

func (h *CarModelHandler) GetByID(c *gin.Context) <span class="cov8" title="1">{
        idParam := c.Param("id")
        id, err := strconv.Atoi(idParam)
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusBadRequest, gin.H{"error": "invalid id"})
                return
        }</span>

        <span class="cov8" title="1">carModel, err := h.Service.GetByID(id)
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">if carModel == nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusNotFound, gin.H{"error": "CarModel not found"})
                return
        }</span>

        <span class="cov8" title="1">c.JSON(http.StatusOK, carModel)</span>
}

func (h *CarModelHandler) Create(c *gin.Context) <span class="cov8" title="1">{
        var body model.CarModel
        if err := c.ShouldBindJSON(&amp;body); err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov8" title="1">if err := h.Service.Create(body); err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov8" title="1">c.JSON(http.StatusCreated, gin.H{"message": "created"})</span>
}
</pre>
		
		<pre class="file" id="file6" style="display: none">package handler

import (
        "auth-service/model"
        "net/http"
        "strconv"

        "github.com/gin-gonic/gin"
)

type CarTypeServiceInterface interface {
        GetAll() ([]model.CarType, error)
        GetByID(id int) (*model.CarType, error)
        Create(model.CarType) error
}

type CarTypeHandler struct {
        Service CarTypeServiceInterface
}

func NewCarTypeHandler(s CarTypeServiceInterface) *CarTypeHandler <span class="cov0" title="0">{
        return &amp;CarTypeHandler{Service: s}
}</span>

func (h *CarTypeHandler) GetAll(c *gin.Context) <span class="cov8" title="1">{
        data, err := h.Service.GetAll()
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov8" title="1">c.JSON(http.StatusOK, data)</span>
}

func (h *CarTypeHandler) GetByID(c *gin.Context) <span class="cov8" title="1">{
        idParam := c.Param("id")
        id, err := strconv.Atoi(idParam)
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusBadRequest, gin.H{"error": "invalid id"})
                return
        }</span>

        <span class="cov8" title="1">carModel, err := h.Service.GetByID(id)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">if carModel == nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusNotFound, gin.H{"error": "CarModel not found"})
                return
        }</span>

        <span class="cov8" title="1">c.JSON(http.StatusOK, carModel)</span>
}

func (h *CarTypeHandler) Create(c *gin.Context) <span class="cov8" title="1">{
        var body model.CarType

        if err := c.ShouldBindJSON(&amp;body); err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">if err := h.Service.Create(body); err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">c.JSON(http.StatusCreated, gin.H{"message": "created"})</span>
}
</pre>
		
		<pre class="file" id="file7" style="display: none">package handler

import (
        "auth-service/service"

        "github.com/gin-gonic/gin"
)

type PopularDestinationHandler struct {
        Service service.PopularDestinationServiceInterface
}

func (h *PopularDestinationHandler) GetAll(c *gin.Context) <span class="cov8" title="1">{
        data, err := h.Service.GetAll()
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(500, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">var resp []map[string]interface{}
        for _, d := range data </span><span class="cov8" title="1">{
                resp = append(resp, map[string]interface{}{
                        "destination": d.Destination,
                        "bookings":    d.Bookings,
                })
        }</span>

        <span class="cov8" title="1">c.JSON(200, resp)</span>
}
</pre>
		
		<pre class="file" id="file8" style="display: none">package handler

import (
        "auth-service/service"
        "net/http"

        "github.com/gin-gonic/gin"
)

type DashboardTripHandler struct {
        service service.DashboardTripServiceInterface
}

func NewDashboardTripHandler(service service.DashboardTripServiceInterface) *DashboardTripHandler <span class="cov8" title="1">{
        return &amp;DashboardTripHandler{service: service}
}</span>

func (h *DashboardTripHandler) GetDashboard(c *gin.Context) <span class="cov8" title="1">{
        data, err := h.service.GetDashboardSummary(c.Request.Context())
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">c.JSON(http.StatusOK, gin.H{
                "success": true,
                "data":    data,
        })</span>
}
</pre>
		
		<pre class="file" id="file9" style="display: none">package handler

import (
        "auth-service/service"
        "net/http"

        "github.com/gin-gonic/gin"
)

type DashboardHandler struct {
        service service.DashboardServiceInterface
}

func NewDashboardHandler(s service.DashboardServiceInterface) *DashboardHandler <span class="cov8" title="1">{
        return &amp;DashboardHandler{service: s}
}</span>

func (h *DashboardHandler) GetDashboard(c *gin.Context) <span class="cov8" title="1">{
        data, err := h.service.GetDashboardData()
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">c.JSON(http.StatusOK, gin.H{
                "success": true,
                "data":    data,
        })</span>
}
</pre>
		
		<pre class="file" id="file10" style="display: none">package handler

import (
        "auth-service/model"
        "net/http"

        "github.com/gin-gonic/gin"
)

type DriverServiceInterface interface {
        GetAll() ([]model.Driver, error)
        Create(*model.Driver) error
        GetByID(string) (*model.Driver, error)
        Update(string, *model.Driver) error
        Delete(string) error
}

type DriverHandler struct {
        Service DriverServiceInterface
}

func NewDriverHandler(service DriverServiceInterface) *DriverHandler <span class="cov8" title="1">{
        return &amp;DriverHandler{Service: service}
}</span>

func (h *DriverHandler) GetAll(c *gin.Context) <span class="cov8" title="1">{
        drivers, err := h.Service.GetAll()
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov8" title="1">c.JSON(http.StatusOK, drivers)</span>
}

func (h *DriverHandler) Create(c *gin.Context) <span class="cov8" title="1">{
        var req struct {
                Name                string `json:"name"`
                Email               string `json:"email"`
                Phone               string `json:"phone"`
                Address             string `json:"address"`
                DriverLicenseNumber string `json:"driver_license_number"`
                CarModelID          string `json:"car_model_id"`
                CarTypeID           string `json:"car_type_id"`
                PlateNumber         string `json:"plate_number"`
                Status              string `json:"status"`
        }

        if err := c.ShouldBindJSON(&amp;req); err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">driver := model.Driver{
                Name:                req.Name,
                Email:               req.Email,
                Phone:               req.Phone,
                Address:             req.Address,
                DriverLicenseNumber: req.DriverLicenseNumber,
                CarModelID:          req.CarModelID,
                CarTypeID:           req.CarTypeID,
                PlateNumber:         req.PlateNumber,
                Status:              req.Status,
        }

        if err := h.Service.Create(&amp;driver); err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">c.JSON(http.StatusCreated, driver)</span>
}

func (h *DriverHandler) GetByID(c *gin.Context) <span class="cov8" title="1">{
        id := c.Param("id")
        driver, err := h.Service.GetByID(id)
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov8" title="1">c.JSON(http.StatusOK, driver)</span>
}

func (h *DriverHandler) Update(c *gin.Context) <span class="cov8" title="1">{
        id := c.Param("id")

        var req struct {
                Name                string `json:"name"`
                Email               string `json:"email"`
                Phone               string `json:"phone"`
                Address             string `json:"address"`
                DriverLicenseNumber string `json:"driver_license_number"`
                CarModelID          string `json:"car_model_id"`
                CarTypeID           string `json:"car_type_id"`
                PlateNumber         string `json:"plate_number"`
                Status              string `json:"status"`
        }

        if err := c.ShouldBindJSON(&amp;req); err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">driver := model.Driver{
                Name:                req.Name,
                Email:               req.Email,
                Phone:               req.Phone,
                Address:             req.Address,
                DriverLicenseNumber: req.DriverLicenseNumber,
                CarModelID:          req.CarModelID,
                CarTypeID:           req.CarTypeID,
                PlateNumber:         req.PlateNumber,
                Status:              req.Status,
        }

        if err := h.Service.Update(id, &amp;driver); err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">c.JSON(http.StatusOK, gin.H{"message": "Driver updated successfully"})</span>
}

func (h *DriverHandler) Delete(c *gin.Context) <span class="cov8" title="1">{
        id := c.Param("id")

        if err := h.Service.Delete(id); err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">c.JSON(http.StatusOK, gin.H{"message": "Driver deleted successfully"})</span>
}
</pre>
		
		<pre class="file" id="file11" style="display: none">package handler

import (
        "auth-service/model"
        "auth-service/service"
        "net/http"
        "strconv"

        "github.com/gin-gonic/gin"
)

type MaintenanceHandler struct {
        Service service.MaintenanceServiceInterface
}

func NewMaintenanceHandler(service service.MaintenanceServiceInterface) *MaintenanceHandler <span class="cov8" title="1">{
        return &amp;MaintenanceHandler{Service: service}
}</span>

func (h *MaintenanceHandler) Create(c *gin.Context) <span class="cov8" title="1">{
        var m model.VehicleMaintenance

        if err := c.ShouldBindJSON(&amp;m); err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">if err := h.Service.Create(&amp;m); err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">c.JSON(http.StatusCreated, m)</span>
}

func (h *MaintenanceHandler) FindByVehicle(c *gin.Context) <span class="cov8" title="1">{
        vehicleIDStr := c.Param("vehicle_id")
        vehicleID, err := strconv.Atoi(vehicleIDStr)
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusBadRequest, gin.H{"error": "invalid vehicle_id"})
                return
        }</span>

        <span class="cov8" title="1">data, err := h.Service.FindByVehicle(vehicleID)
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">c.JSON(http.StatusOK, data)</span>
}

func (h *MaintenanceHandler) Update(c *gin.Context) <span class="cov8" title="1">{
        idStr := c.Param("id")
        id, err := strconv.Atoi(idStr)
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusBadRequest, gin.H{"error": "invalid id"})
                return
        }</span>

        <span class="cov8" title="1">var m model.VehicleMaintenance
        if err := c.ShouldBindJSON(&amp;m); err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">m.ID = uint(id)

        if err := h.Service.Update(&amp;m); err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">c.JSON(http.StatusOK, m)</span>
}

func (h *MaintenanceHandler) Delete(c *gin.Context) <span class="cov8" title="1">{
        idStr := c.Param("id")
        id, err := strconv.Atoi(idStr)
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusBadRequest, gin.H{"error": "invalid id"})
                return
        }</span>

        <span class="cov8" title="1">if err := h.Service.Delete(uint(id)); err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">c.JSON(http.StatusOK, gin.H{"message": "deleted"})</span>
}
</pre>
		
		<pre class="file" id="file12" style="display: none">package handler

import (
        "auth-service/model"
        "auth-service/service"
        "net/http"
        "strconv"

        "github.com/gin-gonic/gin"
)

type PaymentHandler struct {
        Service service.PaymentServiceInterface
}

func (h *PaymentHandler) GetPayments(c *gin.Context) <span class="cov8" title="1">{
        pageStr := c.DefaultQuery("page", "1")
        page, err := strconv.Atoi(pageStr)
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusBadRequest, gin.H{"error": "invalid page"})
                return
        }</span>
        <span class="cov8" title="1">pageSizeStr := c.DefaultQuery("pageSize", "5")
        pageSize, err := strconv.Atoi(pageSizeStr)
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusBadRequest, gin.H{"error": "invalid pageSize"})
                return
        }</span>

        <span class="cov8" title="1">payments, err := h.Service.GetPayments(page, pageSize)
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">c.JSON(http.StatusOK, payments)</span>
}

func (h *PaymentHandler) GetPaymentByID(c *gin.Context) <span class="cov8" title="1">{
        id, err := strconv.Atoi(c.Param("id"))
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusBadRequest, gin.H{"error": "invalid payment id"})
                return
        }</span>

        <span class="cov8" title="1">payment, err := h.Service.GetPaymentByID(c.Request.Context(), id)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">if payment == nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusNotFound, gin.H{"error": "payment not found"})
                return
        }</span>

        <span class="cov8" title="1">c.JSON(http.StatusOK, payment)</span>
}

func (h *PaymentHandler) CreatePayment(c *gin.Context) <span class="cov8" title="1">{
        var p model.Payment

        if err := c.ShouldBindJSON(&amp;p); err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">id, err := h.Service.CreatePayment(c.Request.Context(), &amp;p)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">p.PaymentID = id

        c.JSON(http.StatusCreated, gin.H{
                "message":    "payment created successfully",
                "payment_id": id,
                "data":       p,
        })</span>
}

func (h *PaymentHandler) UpdatePayment(c *gin.Context) <span class="cov8" title="1">{
        id, err := strconv.Atoi(c.Param("id"))
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusBadRequest, gin.H{"error": "invalid payment id"})
                return
        }</span>

        <span class="cov8" title="1">var p model.Payment
        if err := c.ShouldBindJSON(&amp;p); err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">p.PaymentID = id

        err = h.Service.UpdatePayment(c.Request.Context(), &amp;p)
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">c.JSON(http.StatusOK, gin.H{
                "message": "payment updated successfully",
                "data":    p,
        })</span>
}

func (h *PaymentHandler) GetPaymentStats(c *gin.Context) <span class="cov8" title="1">{
        stats, err := h.Service.GetPaymentStats(c.Request.Context())
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">c.JSON(http.StatusOK, gin.H{
                "total_payment":      stats.TotalPayment,
                "pending_payment":    stats.PendingPayment,
                "total_transactions": stats.TotalTransactions,
        })</span>
}

func (h *PaymentHandler) DeletePayment(c *gin.Context) <span class="cov8" title="1">{
        id, err := strconv.Atoi(c.Param("id"))
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusBadRequest, gin.H{"error": "invalid payment id"})
                return
        }</span>

        <span class="cov8" title="1">err = h.Service.DeletePayment(c.Request.Context(), id)
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">c.JSON(http.StatusOK, gin.H{"message": "payment deleted successfully"})</span>
}
</pre>
		
		<pre class="file" id="file13" style="display: none">package handler

import (
        "auth-service/service"
        "fmt"
        "net/http"

        "github.com/gin-gonic/gin"
)

type PDFHandler struct {
        PDFService service.PDFServiceInterface
}

func NewPDFHandler(s service.PDFServiceInterface) *PDFHandler <span class="cov8" title="1">{
        return &amp;PDFHandler{PDFService: s}
}</span>

func (h *PDFHandler) HandlePDFReceipt(c *gin.Context) <span class="cov8" title="1">{
        tripID := c.Param("trip_id")

        pdfBytes, filename, err := h.PDFService.GenerateTripReceiptPDF(tripID)
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">c.Header("Content-Type", "application/pdf")
        c.Header("Content-Disposition", fmt.Sprintf("attachment; filename=%s", filename))
        c.Data(http.StatusOK, "application/pdf", pdfBytes)</span>
}
</pre>
		
		<pre class="file" id="file14" style="display: none">package handler

import (
        "auth-service/model"
        "auth-service/service"
        "net/http"
        "strconv"

        "github.com/gin-gonic/gin"
)

type TripHandler struct {
        service service.TripServiceInterface
}

func NewTripHandler(tripService service.TripServiceInterface) *TripHandler <span class="cov8" title="1">{
        return &amp;TripHandler{service: tripService}
}</span>

func (h *TripHandler) Create(c *gin.Context) <span class="cov8" title="1">{
        var t model.VehicleTrip
        if err := c.ShouldBindJSON(&amp;t); err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov8" title="1">if err := h.service.Create(&amp;t); err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov8" title="1">c.JSON(http.StatusCreated, t)</span>
}

func (h *TripHandler) FindByVehicle(c *gin.Context) <span class="cov8" title="1">{
        vehicleIDStr := c.Param("vehicle_id")
        vehicleID, err := strconv.Atoi(vehicleIDStr)
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusBadRequest, gin.H{"error": "invalid vehicle_id"})
                return
        }</span>
        <span class="cov8" title="1">data, err := h.service.FindByVehicle(uint(vehicleID))
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov8" title="1">c.JSON(http.StatusOK, data)</span>
}

func (h *TripHandler) Update(c *gin.Context) <span class="cov8" title="1">{
        idStr := c.Param("id")
        id, err := strconv.Atoi(idStr)
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusBadRequest, gin.H{"error": "invalid id"})
                return
        }</span>
        <span class="cov8" title="1">var t model.VehicleTrip
        if err := c.ShouldBindJSON(&amp;t); err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov8" title="1">t.ID = uint(id)
        if err := h.service.Update(&amp;t); err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov8" title="1">c.JSON(http.StatusOK, t)</span>
}

func (h *TripHandler) Delete(c *gin.Context) <span class="cov8" title="1">{
        idStr := c.Param("id")
        id, err := strconv.Atoi(idStr)
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusBadRequest, gin.H{"error": "invalid id"})
                return
        }</span>
        <span class="cov8" title="1">if err := h.service.Delete(uint(id)); err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov8" title="1">c.JSON(http.StatusOK, gin.H{"message": "deleted"})</span>
}

func (h *TripHandler) GetTripTotal(c *gin.Context) <span class="cov8" title="1">{
        stats, err := h.service.GetTripTotals(c.Request.Context())
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">c.JSON(http.StatusOK, gin.H{
                "total_trips":    stats.TotalTrips,
                "total_distance": stats.TotalDistance,
                "total_revenue":  stats.TotalRevenue,
                "average_Rating": stats.AverageRating,
        })</span>
}
</pre>
		
		<pre class="file" id="file15" style="display: none">package handler

import (
        "auth-service/model"
        "net/http"

        "github.com/gin-gonic/gin"
)

type TripHistoryServiceInterface interface {
        GetTripHistory() ([]model.TripHistory, error)
}

type TripHistoryHandler struct {
        Service TripHistoryServiceInterface
}

func NewTripHistoryHandler(s TripHistoryServiceInterface) *TripHistoryHandler <span class="cov8" title="1">{
        return &amp;TripHistoryHandler{Service: s}
}</span>

func (h *TripHistoryHandler) GetTripHistory(c *gin.Context) <span class="cov8" title="1">{
        result, err := h.Service.GetTripHistory()
        if err != nil </span><span class="cov8" title="1">{
                c.JSON(http.StatusNotFound, gin.H{"error": "Trip not found"})
                return
        }</span>
        <span class="cov8" title="1">c.JSON(http.StatusOK, result)</span>
}
</pre>
		
		<pre class="file" id="file16" style="display: none">package main

import (
        "database/sql"
        "fmt"
        "log"
)

func main() <span class="cov0" title="0">{
        db, err := sql.Open("postgres",
                "host=localhost port=5432 user=postgres password=1234567 dbname=authdb sslmode=disable")
        if err != nil </span><span class="cov0" title="0">{
                log.Fatal("Failed to connect to database:", err)
        }</span>
        <span class="cov0" title="0">defer db.Close()

        r := SetupRouter(db)

        fmt.Println("Server running at http://localhost:8080")
        if err := r.Run(":8080"); err != nil </span><span class="cov0" title="0">{
                log.Fatal(err)
        }</span>
}
</pre>
		
		<pre class="file" id="file17" style="display: none">package model

type User struct {
        ID       int    `json:"id"`
        Username string `json:"username"`
        Password string `json:"password"`
        Role     string `json:"role"`
}

func (u *User) IsAdmin() bool <span class="cov8" title="1">{
        return u.Role == "admin"
}</span>
</pre>
		
		<pre class="file" id="file18" style="display: none">package repository

import (
        "auth-service/model"
        "database/sql"
)

type AssignmentsRepositoryInterface interface {
        Create(a *model.DriverAssignment) error
        FindByVehicle(vehicleID uint) ([]model.DriverAssignment, error)
        Update(a *model.DriverAssignment) error
        Delete(id uint) error
}

type AssignmentsRepository struct {
        DB *sql.DB
}

func NewAssignmentsRepository(db *sql.DB) *AssignmentsRepository <span class="cov8" title="1">{
        return &amp;AssignmentsRepository{DB: db}
}</span>

func (r *AssignmentsRepository) Create(a *model.DriverAssignment) error <span class="cov8" title="1">{
        query := `INSERT INTO driver_assignments
                         (vehicle_id, start_date, end_date, total_trips, driver_name, status)
                         VALUES ($1, $2, $3, $4, $5, $6)
                         RETURNING id
                        `

        err := r.DB.QueryRow(query,
                a.VehicleID,
                a.StartDate,
                a.EndDate,
                a.TotalTrips,
                a.DriverName,
                a.Status,
        ).Scan(&amp;a.ID)
        return err
}</span>

func (r *AssignmentsRepository) FindByVehicle(vehicleID uint) ([]model.DriverAssignment, error) <span class="cov8" title="1">{
        query := `
    SELECT id, vehicle_id, start_date, end_date, total_trips, driver_name, status
    FROM driver_assignments
    WHERE vehicle_id = $1`

        rows, err := r.DB.Query(query, vehicleID)
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>
        <span class="cov8" title="1">defer rows.Close()

        var list []model.DriverAssignment

        for rows.Next() </span><span class="cov8" title="1">{
                var a model.DriverAssignment
                err := rows.Scan(
                        &amp;a.ID,
                        &amp;a.VehicleID,
                        &amp;a.StartDate,
                        &amp;a.EndDate,
                        &amp;a.TotalTrips,
                        &amp;a.DriverName,
                        &amp;a.Status,
                )
                if err != nil </span><span class="cov0" title="0">{
                        return nil, err
                }</span>
                <span class="cov8" title="1">list = append(list, a)</span>
        }

        <span class="cov8" title="1">return list, nil</span>
}

func (r *AssignmentsRepository) Update(a *model.DriverAssignment) error <span class="cov8" title="1">{
        query := `
        UPDATE driver_assignments
        SET vehicle_id = $1,
                    start_date = $2,
                    end_date = $3,
                    total_trips = $4,
                    driver_name = $5,
                    status = $6
                WHERE id = $7
    `
        _, err := r.DB.Exec(query,
                a.VehicleID,
                a.StartDate,
                a.EndDate,
                a.TotalTrips,
                a.DriverName,
                a.Status,
                a.ID,
        )
        return err
}</span>

func (r *AssignmentsRepository) Delete(id uint) error <span class="cov8" title="1">{
        query := `DELETE FROM driver_assignments WHERE id = $1`
        _, err := r.DB.Exec(query, id)
        return err
}</span>
</pre>
		
		<pre class="file" id="file19" style="display: none">package repository

import (
        "auth-service/model"
        "database/sql"
        "fmt"
        "strings"
        "time"
)

type BookingRepositoryInterface interface {
        Create(*model.Booking) error
        GetAll() ([]model.Booking, error)
        Update(*model.Booking) error
        Delete(id string) error
}

type BookingRepository struct {
        DB *sql.DB
}

func generateBookingID() string <span class="cov8" title="1">{
        t := time.Now()
        return fmt.Sprintf("BK%04d%02d%02d%02d%02d%02d%03d",
                t.Year(), t.Month(), t.Day(),
                t.Hour(), t.Minute(), t.Second(),
                t.Nanosecond()/1e6,
        )
}</span>

func (r *BookingRepository) Create(b *model.Booking) error <span class="cov8" title="1">{
        if b.ID == "" </span><span class="cov8" title="1">{
                b.ID = generateBookingID()
        }</span>

        <span class="cov8" title="1">b.CreatedAt = time.Now()
        b.UpdatedAt = time.Now()

        b.Payment = strings.Title(strings.ToLower(strings.TrimSpace(b.Payment)))
        b.Status = strings.Title(strings.ToLower(strings.TrimSpace(b.Status)))

        _, err := r.DB.Exec(
                `INSERT INTO booking
        (id, customer, driver, place, date, price, status, payment, phone_number, pickup_location, drop_location, pickup_time, amount, notes, created_at, updated_at)
        VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11,$12,$13,$14,$15,$16)`,
                b.ID,
                b.Customer,
                b.Driver,
                b.Place,
                b.Date,
                b.Price,
                b.Status,
                b.Payment,
                b.PhoneNumber,
                b.PickupLocation,
                b.DropLocation,
                b.PickupTime,
                b.Amount,
                b.Notes,
                b.CreatedAt,
                b.UpdatedAt,
        )

        return err</span>
}

func (r *BookingRepository) GetAll() ([]model.Booking, error) <span class="cov8" title="1">{
        var bookings []model.Booking

        rows, err := r.DB.Query(`SELECT id, customer, driver, place, date, price, status, payment, phone_number, pickup_location, drop_location, pickup_time, amount, notes, created_at, updated_at FROM booking`)
        if err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>
        <span class="cov8" title="1">defer rows.Close()

        for rows.Next() </span><span class="cov8" title="1">{
                var b model.Booking
                if err := rows.Scan(
                        &amp;b.ID,
                        &amp;b.Customer,
                        &amp;b.Driver,
                        &amp;b.Place,
                        &amp;b.Date,
                        &amp;b.Price,
                        &amp;b.Status,
                        &amp;b.Payment,
                        &amp;b.PhoneNumber,
                        &amp;b.PickupLocation,
                        &amp;b.DropLocation,
                        &amp;b.PickupTime,
                        &amp;b.Amount,
                        &amp;b.Notes,
                        &amp;b.CreatedAt,
                        &amp;b.UpdatedAt,
                ); err != nil </span><span class="cov0" title="0">{
                        return nil, err
                }</span>
                <span class="cov8" title="1">bookings = append(bookings, b)</span>
        }

        <span class="cov8" title="1">return bookings, nil</span>
}

func (r *BookingRepository) Update(b *model.Booking) error <span class="cov8" title="1">{
        b.UpdatedAt = time.Now()

        b.Payment = strings.Title(strings.ToLower(strings.TrimSpace(b.Payment)))
        b.Status = strings.Title(strings.ToLower(strings.TrimSpace(b.Status)))

        _, err := r.DB.Exec(
                `UPDATE booking SET
                        customer = $1,
                        driver = $2,
                        place = $3,
                        date = $4,
                        price = $5,
                        status = $6,
                        payment = $7,
                        phone_number = $8,
                        pickup_location = $9,
                        drop_location = $10,
                        pickup_time = $11,
                        amount = $12,
                        notes = $13,
                        updated_at = $14
                WHERE id = $15`,
                b.Customer,
                b.Driver,
                b.Place,
                b.Date,
                b.Price,
                b.Status,
                b.Payment,
                b.PhoneNumber,
                b.PickupLocation,
                b.DropLocation,
                b.PickupTime,
                b.Amount,
                b.Notes,
                b.UpdatedAt,
                b.ID,
        )

        return err
}</span>

func (r *BookingRepository) Delete(id string) error <span class="cov8" title="1">{
        _, err := r.DB.Exec(`DELETE FROM booking WHERE id = $1`, id)
        return err
}</span>
</pre>
		
		<pre class="file" id="file20" style="display: none">package repository

import (
        "auth-service/model"
        "database/sql"
)

type BookingTrendsRepositoryInterface interface {
        GetTrends(year int) ([]model.BookingTrend, error)
}

type BookingTrendsRepository struct {
        DB *sql.DB
}

func NewBookingTrendsRepository(db *sql.DB) *BookingTrendsRepository <span class="cov8" title="1">{
        return &amp;BookingTrendsRepository{DB: db}
}</span>

func (r *BookingTrendsRepository) GetTrends(year int) ([]model.BookingTrend, error) <span class="cov8" title="1">{
        rows, err := r.DB.Query(`
        SELECT month, booking_count, year 
        FROM booking_trends 
        WHERE year = $1
        ORDER BY id ASC
    `, year)
        if err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>
        <span class="cov8" title="1">defer rows.Close()

        var trends []model.BookingTrend
        for rows.Next() </span><span class="cov8" title="1">{
                var t model.BookingTrend
                if err := rows.Scan(&amp;t.Month, &amp;t.Booking, &amp;t.Year); err != nil </span><span class="cov0" title="0">{
                        return nil, err
                }</span>
                <span class="cov8" title="1">trends = append(trends, t)</span>
        }

        <span class="cov8" title="1">return trends, nil</span>
}
</pre>
		
		<pre class="file" id="file21" style="display: none">package repository

import (
        "auth-service/model"
        "database/sql"
)

type CarModelRepositoryInterface interface {
        FindAll() ([]model.CarModel, error)
        GetByID(id int) (*model.CarModel, error)
        Create(cm *model.CarModel) error
}

type CarModelRepository struct {
        DB *sql.DB
}

func NewCarModelRepository(db *sql.DB) *CarModelRepository <span class="cov8" title="1">{
        return &amp;CarModelRepository{DB: db}
}</span>

func (r *CarModelRepository) FindAll() ([]model.CarModel, error) <span class="cov8" title="1">{
        rows, err := r.DB.Query("SELECT id, model_name, created_at, updated_at FROM car_model")
        if err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>
        <span class="cov8" title="1">defer rows.Close()

        var list []model.CarModel
        for rows.Next() </span><span class="cov8" title="1">{
                var cm model.CarModel
                if err := rows.Scan(&amp;cm.ID, &amp;cm.ModelName, &amp;cm.CreatedAt, &amp;cm.UpdatedAt); err != nil </span><span class="cov0" title="0">{
                        return nil, err
                }</span>
                <span class="cov8" title="1">list = append(list, cm)</span>
        }
        <span class="cov8" title="1">return list, nil</span>
}

func (r *CarModelRepository) GetByID(id int) (*model.CarModel, error) <span class="cov8" title="1">{
        var cm model.CarModel
        err := r.DB.QueryRow(`
                SELECT id, model_name, created_at, updated_at
                FROM car_model
                WHERE id=$1
        `, id).Scan(&amp;cm.ID, &amp;cm.ModelName, &amp;cm.CreatedAt, &amp;cm.UpdatedAt)

        if err != nil </span><span class="cov8" title="1">{
                if err == sql.ErrNoRows </span><span class="cov8" title="1">{
                        return nil, nil
                }</span>
                <span class="cov8" title="1">return nil, err</span>
        }

        <span class="cov8" title="1">return &amp;cm, nil</span>
}

func (r *CarModelRepository) Create(cm *model.CarModel) error <span class="cov8" title="1">{
        query := `INSERT INTO car_model (model_name, created_at, updated_at)
                  VALUES ($1, $2, $3) RETURNING id`
        return r.DB.QueryRow(query, cm.ModelName, cm.CreatedAt, cm.UpdatedAt).Scan(&amp;cm.ID)
}</span>
</pre>
		
		<pre class="file" id="file22" style="display: none">package repository

import (
        "auth-service/model"
        "database/sql"
)

type CarRepositoryInterface interface {
        GetAll() ([]model.Car, error)
        GetByID(id int) (*model.Car, error)
        Create(v model.Car) error
        Update(id int, v model.Car) error
        Delete(id int) error
}

type CarRepository struct {
        DB *sql.DB
}

func NewCarRepository(db *sql.DB) *CarRepository <span class="cov8" title="1">{
        return &amp;CarRepository{DB: db}
}</span>

func (r *CarRepository) GetAll() ([]model.Car, error) <span class="cov8" title="1">{
        rows, err := r.DB.Query(`
                SELECT id, brand, model, year, plate_number, capacity, color,
                       driver_id, last_maintenance_date, current_km
                FROM vehicles
        `)
        if err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>
        <span class="cov8" title="1">defer rows.Close()

        var cars []model.Car

        for rows.Next() </span><span class="cov8" title="1">{
                var v model.Car
                err := rows.Scan(
                        &amp;v.ID,
                        &amp;v.Brand,
                        &amp;v.Model,
                        &amp;v.Year,
                        &amp;v.PlateNumber,
                        &amp;v.Capacity,
                        &amp;v.Color,
                        &amp;v.DriverID,
                        &amp;v.LastMaintenanceDate,
                        &amp;v.CurrentKM,
                )
                if err != nil </span><span class="cov0" title="0">{
                        return nil, err
                }</span>
                <span class="cov8" title="1">cars = append(cars, v)</span>
        }

        <span class="cov8" title="1">return cars, nil</span>
}

func (r *CarRepository) GetByID(id int) (*model.Car, error) <span class="cov8" title="1">{
        var v model.Car
        err := r.DB.QueryRow(`
                SELECT id, brand, model, year, plate_number, capacity, color,
                       driver_id, last_maintenance_date, current_km
                FROM vehicles WHERE id=$1
        `, id).Scan(
                &amp;v.ID, &amp;v.Brand, &amp;v.Model, &amp;v.Year,
                &amp;v.PlateNumber, &amp;v.Capacity, &amp;v.Color,
                &amp;v.DriverID, &amp;v.LastMaintenanceDate, &amp;v.CurrentKM,
        )

        if err != nil </span><span class="cov8" title="1">{
                if err == sql.ErrNoRows </span><span class="cov8" title="1">{
                        return nil, nil
                }</span>
                <span class="cov8" title="1">return nil, err</span>
        }

        <span class="cov8" title="1">return &amp;v, nil</span>
}

func (r *CarRepository) Create(v model.Car) error <span class="cov8" title="1">{
        _, err := r.DB.Exec(`
                INSERT INTO vehicles 
                (brand, model, year, plate_number, capacity, color, driver_id, last_maintenance_date, current_km)
                VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9)
        `,
                v.Brand, v.Model, v.Year, v.PlateNumber,
                v.Capacity, v.Color, v.DriverID,
                v.LastMaintenanceDate, v.CurrentKM,
        )
        return err
}</span>

func (r *CarRepository) Update(id int, v model.Car) error <span class="cov8" title="1">{
        _, err := r.DB.Exec(`
                UPDATE vehicles SET 
                        brand=$1, model=$2, year=$3, plate_number=$4,
                        capacity=$5, color=$6, driver_id=$7,
                        last_maintenance_date=$8, current_km=$9
                WHERE id=$10
        `,
                v.Brand, v.Model, v.Year, v.PlateNumber,
                v.Capacity, v.Color, v.DriverID,
                v.LastMaintenanceDate, v.CurrentKM,
                id,
        )

        return err
}</span>

func (r *CarRepository) Delete(id int) error <span class="cov8" title="1">{
        _, err := r.DB.Exec(`DELETE FROM vehicles WHERE id=$1`, id)
        return err
}</span>
</pre>
		
		<pre class="file" id="file23" style="display: none">package repository

import (
        "auth-service/model"
        "database/sql"
)

type CarTypeRepositoryInterface interface {
        FindAll() ([]model.CarType, error)
        GetByID(id int) (*model.CarType, error)
        Create(ct model.CarType) error
}

type CarTypeRepository struct {
        DB *sql.DB
}

func NewCarTypeRepository(db *sql.DB) *CarTypeRepository <span class="cov8" title="1">{
        return &amp;CarTypeRepository{DB: db}
}</span>

func (r *CarTypeRepository) FindAll() ([]model.CarType, error) <span class="cov8" title="1">{
        rows, err := r.DB.Query("SELECT id, type_name FROM car_type")
        if err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>
        <span class="cov8" title="1">defer rows.Close()

        var list []model.CarType
        for rows.Next() </span><span class="cov8" title="1">{
                var ct model.CarType
                if err := rows.Scan(&amp;ct.ID, &amp;ct.TypeName); err != nil </span><span class="cov0" title="0">{
                        return nil, err
                }</span>
                <span class="cov8" title="1">list = append(list, ct)</span>
        }
        <span class="cov8" title="1">return list, nil</span>
}

func (r *CarTypeRepository) GetByID(id int) (*model.CarType, error) <span class="cov8" title="1">{
        var cm model.CarType
        err := r.DB.QueryRow(`
                SELECT id, type_name
                FROM car_type
                WHERE id=$1
        `, id).Scan(&amp;cm.ID, &amp;cm.TypeName)

        if err != nil </span><span class="cov8" title="1">{
                if err == sql.ErrNoRows </span><span class="cov8" title="1">{
                        return nil, nil
                }</span>
                <span class="cov8" title="1">return nil, err</span>
        }

        <span class="cov8" title="1">return &amp;cm, nil</span>
}

func (r *CarTypeRepository) Create(ct model.CarType) error <span class="cov8" title="1">{
        _, err := r.DB.Exec(
                "INSERT INTO car_type (type_name) VALUES ($1)",
                ct.TypeName,
        )
        return err
}</span>
</pre>
		
		<pre class="file" id="file24" style="display: none">package repository

import (
        "database/sql"

        "auth-service/model"
)

type PopularDestinationRepositoryInterface interface {
        GetAll() ([]model.PopularDestination, error)
        Add(pd model.PopularDestination) (*model.PopularDestination, error)
        UpdateBookings(id int, bookings int) error
        Delete(id int) error
}

type PopularDestinationRepository struct {
        DB *sql.DB
}

func (r *PopularDestinationRepository) GetAll() ([]model.PopularDestination, error) <span class="cov8" title="1">{
        rows, err := r.DB.Query("SELECT id, destination, bookings, created_at FROM popular_destinations ORDER BY bookings DESC")
        if err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>
        <span class="cov8" title="1">defer rows.Close()

        var result []model.PopularDestination
        for rows.Next() </span><span class="cov8" title="1">{
                var pd model.PopularDestination
                if err := rows.Scan(&amp;pd.ID, &amp;pd.Destination, &amp;pd.Bookings, &amp;pd.CreatedAt); err != nil </span><span class="cov0" title="0">{
                        return nil, err
                }</span>
                <span class="cov8" title="1">result = append(result, pd)</span>
        }
        <span class="cov8" title="1">return result, nil</span>
}

func (r *PopularDestinationRepository) Add(pd model.PopularDestination) (*model.PopularDestination, error) <span class="cov8" title="1">{
        err := r.DB.QueryRow(
                "INSERT INTO popular_destinations (destination, bookings) VALUES ($1, $2) RETURNING id, created_at",
                pd.Destination, pd.Bookings,
        ).Scan(&amp;pd.ID, &amp;pd.CreatedAt)
        if err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>
        <span class="cov8" title="1">return &amp;pd, nil</span>
}

func (r *PopularDestinationRepository) UpdateBookings(id int, bookings int) error <span class="cov8" title="1">{
        _, err := r.DB.Exec("UPDATE popular_destinations SET bookings = $1 WHERE id = $2", bookings, id)
        return err
}</span>

func (r *PopularDestinationRepository) Delete(id int) error <span class="cov8" title="1">{
        _, err := r.DB.Exec("DELETE FROM popular_destinations WHERE id = $1", id)
        return err
}</span>
</pre>
		
		<pre class="file" id="file25" style="display: none">package repository

import (
        "auth-service/model"
        "context"
        "database/sql"
)

type DashboardTripRepositoryInterface interface {
        GetDashboardSummary(ctx context.Context) (*model.DashboardSummary, error)
}

type DashboardTripRepository struct {
        DB *sql.DB
}

func NewDashboardTripRepository(db *sql.DB) *DashboardTripRepository <span class="cov8" title="1">{
        return &amp;DashboardTripRepository{DB: db}
}</span>

func (r *DashboardTripRepository) GetDashboardSummary(ctx context.Context) (*model.DashboardSummary, error) <span class="cov8" title="1">{

        summary := &amp;model.DashboardSummary{}

        err := r.DB.QueryRowContext(ctx, `
                SELECT COUNT(*) FROM vehicle_trips
        `).Scan(&amp;summary.TotalTrips)
        if err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>

        <span class="cov8" title="1">err = r.DB.QueryRowContext(ctx, `
                SELECT COALESCE(SUM(distance_km), 0) FROM vehicle_trips
        `).Scan(&amp;summary.TotalDistance)
        if err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>

        <span class="cov8" title="1">err = r.DB.QueryRowContext(ctx, `
                SELECT COALESCE(SUM(duration), 0) FROM vehicle_trips
        `).Scan(&amp;summary.TotalDuration)
        if err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>

        <span class="cov8" title="1">return summary, nil</span>
}
</pre>
		
		<pre class="file" id="file26" style="display: none">package repository

import "database/sql"

type DashboardRepositoryInterface interface {
        GetTotalBookings() (int, error)
        GetActiveDrivers() (int, error)
        GetTotalRevenue() (float64, error)
}

type DashboardRepository struct {
        DB *sql.DB
}

func NewDashboardRepository(db *sql.DB) *DashboardRepository <span class="cov8" title="1">{
        return &amp;DashboardRepository{DB: db}
}</span>

func (r *DashboardRepository) GetTotalBookings() (int, error) <span class="cov8" title="1">{
        var count int
        err := r.DB.QueryRow(`SELECT COUNT(*) FROM booking`).Scan(&amp;count)
        return count, err
}</span>

func (r *DashboardRepository) GetActiveDrivers() (int, error) <span class="cov8" title="1">{
        var count int
        err := r.DB.QueryRow(`SELECT COUNT(*) FROM drivers WHERE status = 'active'`).Scan(&amp;count)
        return count, err
}</span>

func (r *DashboardRepository) GetTotalRevenue() (float64, error) <span class="cov8" title="1">{
        var total float64
        err := r.DB.QueryRow(`
    SELECT COALESCE(SUM(amount), 0)::FLOAT  FROM payment`).Scan(&amp;total)
        return total, err
}</span>
</pre>
		
		<pre class="file" id="file27" style="display: none">package repository

import (
        "auth-service/model"
        "database/sql"
)

type DriverRepositoryInterface interface {
        GetAll() ([]model.Driver, error)
        Create(d *model.Driver) error
        GetByID(id string) (*model.Driver, error)
        Update(id string, d *model.Driver) error
        Delete(id string) error
}

type DriverRepository struct {
        DB *sql.DB
}

func (r *DriverRepository) GetAll() ([]model.Driver, error) <span class="cov8" title="1">{
        rows, err := r.DB.Query("SELECT id, name, email, phone, address, driver_license_number, car_model_id, car_type_id, plate_number, status, created_at, updated_at FROM drivers")
        if err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>
        <span class="cov8" title="1">defer rows.Close()

        var drivers []model.Driver
        for rows.Next() </span><span class="cov8" title="1">{
                var d model.Driver
                if err := rows.Scan(&amp;d.ID, &amp;d.Name, &amp;d.Email, &amp;d.Phone, &amp;d.Address, &amp;d.DriverLicenseNumber, &amp;d.CarModelID, &amp;d.CarTypeID, &amp;d.PlateNumber,
                        &amp;d.Status, &amp;d.CreatedAt, &amp;d.UpdatedAt); err != nil </span><span class="cov0" title="0">{
                        return nil, err
                }</span>
                <span class="cov8" title="1">drivers = append(drivers, d)</span>
        }

        <span class="cov8" title="1">if err := rows.Err(); err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov8" title="1">return drivers, nil</span>
}

func (r *DriverRepository) Create(d *model.Driver) error <span class="cov8" title="1">{
        query := `
    INSERT INTO drivers (name, email, phone, address, driver_license_number, car_model_id, car_type_id, plate_number,status, created_at, updated_at)
    VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, NOW(), NOW())
    RETURNING id, created_at, updated_at;
`

        return r.DB.QueryRow(
                query,
                d.Name, d.Email, d.Phone, d.Address, d.DriverLicenseNumber, d.CarModelID, d.CarTypeID, d.PlateNumber, d.Status,
        ).Scan(&amp;d.ID, &amp;d.CreatedAt, &amp;d.UpdatedAt)
}</span>

func (r *DriverRepository) GetByID(id string) (*model.Driver, error) <span class="cov8" title="1">{
        var d model.Driver
        err := r.DB.QueryRow("SELECT id, name, email, phone, address, driver_license_number, car_model_id, car_type_id, plate_number, status, created_at, updated_at FROM drivers WHERE id = $1", id).Scan(&amp;d.ID, &amp;d.Name, &amp;d.Email, &amp;d.Phone, &amp;d.Address, &amp;d.DriverLicenseNumber, &amp;d.CarModelID, &amp;d.CarTypeID, &amp;d.PlateNumber, &amp;d.Status, &amp;d.CreatedAt, &amp;d.UpdatedAt)
        if err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>
        <span class="cov8" title="1">return &amp;d, nil</span>
}

func (r *DriverRepository) Update(id string, d *model.Driver) error <span class="cov8" title="1">{
        query := `
        UPDATE drivers
        SET name=$1, email=$2, phone=$3, address=$4, driver_license_number=$5, car_model_id=$6, car_type_id=$7, plate_number=$8,
                status=$9, updated_at=NOW()
        WHERE id=$10
    `
        _, err := r.DB.Exec(query, d.Name, d.Email, d.Phone, d.Address, d.DriverLicenseNumber, d.CarModelID, d.CarTypeID, d.PlateNumber, d.Status, id)
        return err
}</span>

func (r *DriverRepository) Delete(id string) error <span class="cov8" title="1">{
        query := `DELETE FROM drivers WHERE id=$1`
        _, err := r.DB.Exec(query, id)
        return err
}</span>
</pre>
		
		<pre class="file" id="file28" style="display: none">package repository

import (
        "auth-service/model"
        "database/sql"
)

type MaintenanceRepositoryInterface interface {
        Create(*model.VehicleMaintenance) error
        FindByVehicle(vehicleID int) ([]model.VehicleMaintenance, error)
        Update(*model.VehicleMaintenance) error
        Delete(id uint) error
}

type MaintenanceRepository struct {
        DB *sql.DB
}

func NewMaintenanceRepository(db *sql.DB) *MaintenanceRepository <span class="cov8" title="1">{
        return &amp;MaintenanceRepository{DB: db}
}</span>

func (r *MaintenanceRepository) Create(m *model.VehicleMaintenance) error <span class="cov8" title="1">{
        query := `
        INSERT INTO vehicle_maintenance (vehicle_id, service_date, description, cost, mileage, service_type)
        VALUES ($1, $2, $3, $4, $5, $6)`

        _, err := r.DB.Exec(query, m.VehicleID, m.ServiceDate, m.Description, m.Cost, m.Mileage, m.ServiceType)
        return err
}</span>

func (r *MaintenanceRepository) FindByVehicle(vehicleID int) ([]model.VehicleMaintenance, error) <span class="cov8" title="1">{
        query := `
        SELECT id, vehicle_id, service_date, description, cost , mileage , service_type
        FROM vehicle_maintenance
        WHERE vehicle_id = $1
        ORDER BY service_date DESC`

        rows, err := r.DB.Query(query, vehicleID)
        if err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>
        <span class="cov8" title="1">defer rows.Close()

        var list []model.VehicleMaintenance

        for rows.Next() </span><span class="cov8" title="1">{
                var m model.VehicleMaintenance
                if err := rows.Scan(&amp;m.ID, &amp;m.VehicleID, &amp;m.ServiceDate, &amp;m.Description, &amp;m.Cost, &amp;m.Mileage, &amp;m.ServiceType); err != nil </span><span class="cov0" title="0">{
                        return nil, err
                }</span>
                <span class="cov8" title="1">list = append(list, m)</span>
        }

        <span class="cov8" title="1">return list, nil</span>
}

func (r *MaintenanceRepository) Update(m *model.VehicleMaintenance) error <span class="cov8" title="1">{
        query := `
        UPDATE vehicle_maintenance
        SET vehicle_id = $1,
            service_date = $2,
            description = $3,
            cost = $4,
            mileage = $5,
            service_type = $6
        WHERE id = $7`

        _, err := r.DB.Exec(query,
                m.VehicleID,
                m.ServiceDate,
                m.Description,
                m.Cost,
                m.Mileage,
                m.ServiceType,
                m.ID,
        )

        return err
}</span>

func (r *MaintenanceRepository) Delete(id uint) error <span class="cov8" title="1">{
        query := `DELETE FROM vehicle_maintenance WHERE id = $1`
        _, err := r.DB.Exec(query, id)
        return err
}</span>
</pre>
		
		<pre class="file" id="file29" style="display: none">package repository

import (
        "auth-service/model"
        "context"
        "database/sql"
        "errors"
)

type PaymentRepositoryInterface interface {
        GetPayments(page, pageSize int) ([]model.Payment, error)
        GetPaymentStats(ctx context.Context) (*model.PaymentStats, error)
        GetAll(ctx context.Context) ([]model.Payment, error)
        GetByID(ctx context.Context, id int) (*model.Payment, error)
        Create(ctx context.Context, p *model.Payment) (int, error)
        Update(ctx context.Context, p *model.Payment) error
        Delete(ctx context.Context, id int) error
}

type PaymentRepository struct {
        DB *sql.DB
}

func NewPaymentRepository(db *sql.DB) *PaymentRepository <span class="cov8" title="1">{
        return &amp;PaymentRepository{DB: db}
}</span>

func (r *PaymentRepository) GetPaymentStats(ctx context.Context) (*model.PaymentStats, error) <span class="cov8" title="1">{
        stats := &amp;model.PaymentStats{}

        err := r.DB.QueryRowContext(ctx, `
        SELECT 
                CAST(COALESCE(SUM(amount), 0) AS BIGINT) 
                FROM payment 
        WHERE status = 'paid';
        `).Scan(&amp;stats.TotalPayment)
        if err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>

        <span class="cov8" title="1">err = r.DB.QueryRowContext(ctx, `
        SELECT 
                        CAST(COALESCE(SUM(amount), 0) AS BIGINT) 
                        FROM payment 
                WHERE status = 'pending';

    `).Scan(&amp;stats.PendingPayment)
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov8" title="1">err = r.DB.QueryRowContext(ctx, `
        SELECT COUNT(*)
        FROM payment
    `).Scan(&amp;stats.TotalTransactions)
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov8" title="1">return stats, nil</span>
}

func (r *PaymentRepository) GetPayments(page, pageSize int) ([]model.Payment, error) <span class="cov8" title="1">{
        offset := (page - 1) * pageSize
        query := `SELECT payment_id, booking_id, customer, driver, amount, method, status, payment_date FROM payment LIMIT $1 OFFSET $2`
        rows, err := r.DB.Query(query, pageSize, offset)
        if err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>
        <span class="cov8" title="1">defer rows.Close()

        var payments []model.Payment
        for rows.Next() </span><span class="cov8" title="1">{
                var p model.Payment
                if err := rows.Scan(
                        &amp;p.PaymentID,
                        &amp;p.BookingID,
                        &amp;p.Customer,
                        &amp;p.Driver,
                        &amp;p.Amount,
                        &amp;p.Method,
                        &amp;p.Status,
                        &amp;p.PaymentDate,
                ); err != nil </span><span class="cov0" title="0">{
                        return nil, err
                }</span>

                <span class="cov8" title="1">payments = append(payments, p)</span>
        }

        <span class="cov8" title="1">return payments, nil</span>
}

func (r *PaymentRepository) GetAll(ctx context.Context) ([]model.Payment, error) <span class="cov8" title="1">{
        rows, err := r.DB.QueryContext(ctx,
                `SELECT payment_id, booking_id, customer, driver, amount, method, status, payment_date 
                 FROM payment`)
        if err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>
        <span class="cov8" title="1">defer rows.Close()

        var payments []model.Payment

        for rows.Next() </span><span class="cov8" title="1">{
                var p model.Payment
                if err := rows.Scan(
                        &amp;p.PaymentID,
                        &amp;p.BookingID,
                        &amp;p.Customer,
                        &amp;p.Driver,
                        &amp;p.Amount,
                        &amp;p.Method,
                        &amp;p.Status,
                        &amp;p.PaymentDate,
                ); err != nil </span><span class="cov0" title="0">{
                        return nil, err
                }</span>
                <span class="cov8" title="1">payments = append(payments, p)</span>
        }

        <span class="cov8" title="1">if err := rows.Err(); err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov8" title="1">return payments, nil</span>
}

func (r *PaymentRepository) GetByID(ctx context.Context, id int) (*model.Payment, error) <span class="cov8" title="1">{
        var p model.Payment

        err := r.DB.QueryRowContext(ctx,
                `SELECT payment_id, booking_id, customer, driver, amount, method, status, payment_date 
                 FROM payment 
                 WHERE payment_id=$1`,
                id,
        ).Scan(
                &amp;p.PaymentID,
                &amp;p.BookingID,
                &amp;p.Customer,
                &amp;p.Driver,
                &amp;p.Amount,
                &amp;p.Method,
                &amp;p.Status,
                &amp;p.PaymentDate,
        )

        if errors.Is(err, sql.ErrNoRows) </span><span class="cov8" title="1">{
                return nil, nil
        }</span>

        <span class="cov8" title="1">if err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>

        <span class="cov8" title="1">return &amp;p, nil</span>
}

func (r *PaymentRepository) Create(ctx context.Context, p *model.Payment) (int, error) <span class="cov8" title="1">{
        var id int

        err := r.DB.QueryRowContext(ctx,
                `INSERT INTO payment (booking_id, customer, driver, amount, method, status) 
         VALUES ($1,$2,$3,$4,$5,$6) 
         RETURNING payment_id`,
                p.BookingID,
                p.Customer,
                p.Driver,
                p.Amount,
                p.Method,
                p.Status,
        ).Scan(&amp;id)

        if err != nil </span><span class="cov8" title="1">{
                return 0, err
        }</span>

        <span class="cov8" title="1">return id, nil</span>
}

func (r *PaymentRepository) Update(ctx context.Context, p *model.Payment) error <span class="cov8" title="1">{
        _, err := r.DB.ExecContext(ctx,
                `UPDATE payment 
                 SET booking_id=$1, customer=$2, driver=$3, amount=$4, method=$5, status=$6
                 WHERE payment_id=$7`,
                p.BookingID,
                p.Customer,
                p.Driver,
                p.Amount,
                p.Method,
                p.Status,
                p.PaymentID,
        )

        return err
}</span>

func (r *PaymentRepository) Delete(ctx context.Context, id int) error <span class="cov8" title="1">{
        _, err := r.DB.ExecContext(ctx,
                `DELETE FROM payment WHERE payment_id=$1`, id)
        return err
}</span>
</pre>
		
		<pre class="file" id="file30" style="display: none">package repository

import (
        "auth-service/model"
        "database/sql"
)

type PDFRepositoryInterface interface {
        GetTripByID(tripID string) (model.Pdf, error)
}

type PDFRepository struct {
        DB *sql.DB
}

func NewPDFRepository(db *sql.DB) *PDFRepository <span class="cov8" title="1">{
        return &amp;PDFRepository{DB: db}
}</span>

func (r *PDFRepository) GetTripByID(tripID string) (model.Pdf, error) <span class="cov8" title="1">{
        var trip model.Pdf

        query := `
        SELECT
            id, customer_name, booking_date, duration_minutes, distance_km,
            pickup_location, destination, driver_name, vehicle_name,
            amount, rating, feedback
        FROM trips
        WHERE id = $1
    `

        row := r.DB.QueryRow(query, tripID)

        err := row.Scan(
                &amp;trip.ID,
                &amp;trip.CustomerName,
                &amp;trip.BookingDate,
                &amp;trip.DurationMinutes,
                &amp;trip.DistanceKM,
                &amp;trip.PickupLocation,
                &amp;trip.Destination,
                &amp;trip.DriverName,
                &amp;trip.VehicleName,
                &amp;trip.Amount,
                &amp;trip.Rating,
                &amp;trip.Feedback,
        )

        if err != nil </span><span class="cov8" title="1">{
                if err == sql.ErrNoRows </span><span class="cov8" title="1">{
                        return model.Pdf{}, nil
                }</span>
                <span class="cov8" title="1">return model.Pdf{}, err</span>
        }

        <span class="cov8" title="1">return trip, nil</span>
}
</pre>
		
		<pre class="file" id="file31" style="display: none">package repository

import (
        "auth-service/model"
        "database/sql"
)

type TripHistoryRepositoryInterface interface {
        GetTripHistory() ([]model.TripHistory, error)
}

type TripHistoryRepository struct {
        DB *sql.DB
}

func NewTripHistoryRepository(db *sql.DB) *TripHistoryRepository <span class="cov8" title="1">{
        return &amp;TripHistoryRepository{DB: db}
}</span>

func (r *TripHistoryRepository) GetTripHistory() ([]model.TripHistory, error) <span class="cov8" title="1">{
        query := `
        SELECT id, booking_code, customer_name, booking_date,
               duration_minutes, distance_km, pickup_location, destination,
               driver_name, vehicle_name, amount, rating, feedback
        FROM trips
    `
        rows, err := r.DB.Query(query)
        if err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>
        <span class="cov8" title="1">defer rows.Close()

        trips := []model.TripHistory{} // penting: default empty slice

        for rows.Next() </span><span class="cov8" title="1">{
                var b model.TripHistory
                err := rows.Scan(
                        &amp;b.ID, &amp;b.BookingCode, &amp;b.CustomerName, &amp;b.BookingDate,
                        &amp;b.DurationMinutes, &amp;b.DistanceKM, &amp;b.PickupLocation,
                        &amp;b.Destination, &amp;b.DriverName, &amp;b.VehicleName,
                        &amp;b.Amount, &amp;b.Rating, &amp;b.Feedback,
                )
                if err != nil </span><span class="cov0" title="0">{
                        return nil, err
                }</span>
                <span class="cov8" title="1">trips = append(trips, b)</span>
        }

        <span class="cov8" title="1">if err = rows.Err(); err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov8" title="1">return trips, nil</span>
}
</pre>
		
		<pre class="file" id="file32" style="display: none">package repository

import (
        "auth-service/model"
        "context"
        "database/sql"
)

type TripsRepositoryInterface interface {
        Create(t *model.VehicleTrip) error
        Update(t *model.VehicleTrip) error
        Delete(id uint) error
        FindByVehicle(vehicleID uint) ([]model.VehicleTrip, error)
        GetTripTotal(ctx context.Context) (*model.TotalTrips, error)
}

type TripsRepository struct {
        DB *sql.DB
}

func NewTripRepo(db *sql.DB) *TripsRepository <span class="cov8" title="1">{
        return &amp;TripsRepository{DB: db}
}</span>
func (r *TripsRepository) Create(t *model.VehicleTrip) error <span class="cov8" title="1">{
        query := `
                INSERT INTO vehicle_trips
                (vehicle_id, trip_date, origin, destination, rating, price, passenger_name, distance_km)
                VALUES ($1, $2, $3, $4, $5, $6, $7)
        `
        _, err := r.DB.Exec(query,
                t.VehicleID,
                t.TripDate,
                t.Origin,
                t.Destination,
                t.Rating,
                t.Price,
                t.PassengerName,
                t.DistanceKM,
        )
        return err
}</span>

func (r *TripsRepository) Update(t *model.VehicleTrip) error <span class="cov8" title="1">{
        query := `
                UPDATE vehicle_trips
                SET vehicle_id = $1,
                        trip_date = $2,
                        origin = $3,
                        destination = $4,
                        rating = $5,
                        price = $6
                        passenger_name = $7
                        distance_km = $8
                WHERE id = $9
        `
        _, err := r.DB.Exec(query,
                t.VehicleID,
                t.TripDate,
                t.Origin,
                t.Destination,
                t.Rating,
                t.Price,
                t.PassengerName,
                t.DistanceKM,
                t.ID,
        )
        return err
}</span>

func (r *TripsRepository) Delete(id uint) error <span class="cov8" title="1">{
        query := `DELETE FROM vehicle_trips WHERE id = $1`
        _, err := r.DB.Exec(query, id)
        return err
}</span>

func (r *TripsRepository) FindByID(id uint) (*model.VehicleTrip, error) <span class="cov8" title="1">{
        query := `
                SELECT id, vehicle_id, trip_date, origin, destination, rating, price, passenger_name, distance_km
                FROM vehicle_trips
                WHERE id = $1
        `
        row := r.DB.QueryRow(query, id)
        var t model.VehicleTrip
        err := row.Scan(
                &amp;t.ID,
                &amp;t.VehicleID,
                &amp;t.TripDate,
                &amp;t.Origin,
                &amp;t.Destination,
                &amp;t.Rating,
                &amp;t.Price,
                &amp;t.PassengerName,
                &amp;t.DistanceKM,
        )
        if err != nil </span><span class="cov8" title="1">{
                if err == sql.ErrNoRows </span><span class="cov8" title="1">{
                        return nil, nil
                }</span>
                <span class="cov8" title="1">return nil, err</span>
        }
        <span class="cov8" title="1">return &amp;t, nil</span>
}

func (r *TripsRepository) FindByVehicle(vehicleID uint) ([]model.VehicleTrip, error) <span class="cov8" title="1">{
        query := `
                SELECT id, vehicle_id, trip_date, origin, destination, rating, price, passenger_name, distance_km
                FROM vehicle_trips
                WHERE vehicle_id = $1
        `
        rows, err := r.DB.Query(query, vehicleID)
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>
        <span class="cov8" title="1">defer rows.Close()
        var trips []model.VehicleTrip
        for rows.Next() </span><span class="cov8" title="1">{
                var t model.VehicleTrip
                err := rows.Scan(
                        &amp;t.ID,
                        &amp;t.VehicleID,
                        &amp;t.TripDate,
                        &amp;t.Origin,
                        &amp;t.Destination,
                        &amp;t.Rating,
                        &amp;t.Price,
                        &amp;t.PassengerName,
                        &amp;t.DistanceKM,
                )
                if err != nil </span><span class="cov0" title="0">{
                        return nil, err
                }</span>
                <span class="cov8" title="1">trips = append(trips, t)</span>
        }
        <span class="cov8" title="1">return trips, nil</span>
}

func (r *TripsRepository) GetTripTotal(ctx context.Context) (*model.TotalTrips, error) <span class="cov8" title="1">{
        stats := &amp;model.TotalTrips{}

        err := r.DB.QueryRowContext(ctx, `
                SELECT COUNT(*) 
                FROM vehicle_trips;
        `).Scan(&amp;stats.TotalTrips)
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov8" title="1">err = r.DB.QueryRowContext(ctx, `
                SELECT COALESCE(SUM(distance_km), 0)
                FROM vehicle_trips;
        `).Scan(&amp;stats.TotalDistance)
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov8" title="1">err = r.DB.QueryRowContext(ctx, `
                SELECT COALESCE(SUM(price), 0)
                FROM vehicle_trips;
        `).Scan(&amp;stats.TotalRevenue)
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov8" title="1">err = r.DB.QueryRowContext(ctx, `
                SELECT COALESCE(AVG(rating), 0)
                FROM vehicle_trips;
        `).Scan(&amp;stats.AverageRating)
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov8" title="1">return stats, nil</span>
}
</pre>
		
		<pre class="file" id="file33" style="display: none">package repository

import (
        "auth-service/model"
        "database/sql"
)

type UserRepository struct {
        DB *sql.DB
}

func (r *UserRepository) GetUserWithRole(username string) (*model.User, error) <span class="cov8" title="1">{
        var user model.User

        query := `
                SELECT u.id, u.username, u.password, r.role_name
                FROM users u
                JOIN user_roles ur ON ur.user_id = u.id
                JOIN roles r ON r.id = ur.role_id
                WHERE u.username = $1
        `

        err := r.DB.QueryRow(query, username).Scan(
                &amp;user.ID,
                &amp;user.Username,
                &amp;user.Password,
                &amp;user.Role,
        )

        if err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>

        <span class="cov8" title="1">return &amp;user, nil</span>
}
</pre>
		
		<pre class="file" id="file34" style="display: none">package main

import (
        "auth-service/handler"
        "auth-service/repository"
        "auth-service/service"
        "database/sql"
        "time"

        "github.com/gin-contrib/cors"
        "github.com/gin-gonic/gin"
)

func SetupRouter(db *sql.DB) *gin.Engine <span class="cov8" title="1">{

        userRepo := &amp;repository.UserRepository{DB: db}
        driverRepo := &amp;repository.DriverRepository{DB: db}
        bookingRepo := &amp;repository.BookingRepository{DB: db}
        popularRepo := &amp;repository.PopularDestinationRepository{DB: db}
        carRepo := repository.NewCarRepository(db)
        paymentRepo := repository.NewPaymentRepository(db)

        authService := &amp;service.AuthService{Repo: userRepo}
        driverService := &amp;service.DriverService{Repo: driverRepo}
        bookingService := &amp;service.BookingService{Repo: bookingRepo}
        popularService := &amp;service.PopularDestinationService{Repo: popularRepo}
        carService := service.NewCarService(carRepo)
        paymentService := service.NewPaymentService(paymentRepo)

        authHandler := &amp;handler.AuthHandler{AuthService: authService}
        driverHandler := &amp;handler.DriverHandler{Service: driverService}
        bookingHandler := &amp;handler.BookingHandler{BookingService: bookingService}
        popularHandler := &amp;handler.PopularDestinationHandler{Service: popularService}
        carHandler := handler.NewCarHandler(carService)
        paymentHandler := handler.PaymentHandler{Service: paymentService}

        maintenanceRepo := repository.NewMaintenanceRepository(db)
        maintenanceService := service.NewMaintenanceService(maintenanceRepo)
        maintenanceHandler := handler.NewMaintenanceHandler(maintenanceService)

        assignmentRepo := repository.NewAssignmentsRepository(db)
        assignmentService := service.NewAssignmentsService(assignmentRepo)
        assignmentHandler := handler.NewAssignmentHandler(assignmentService)

        tripRepo := repository.NewTripRepo(db)
        tripService := service.NewTripService(tripRepo)
        tripHandler := handler.NewTripHandler(tripService)

        tripHistoryRepo := repository.NewTripHistoryRepository(db)
        tripHistoryService := service.NewTripHistoryService(tripHistoryRepo)
        tripHistoryHandler := handler.NewTripHistoryHandler(tripHistoryService)

        bookingTrendsRepo := repository.NewBookingTrendsRepository(db)
        bookingTrendsService := service.NewBookingTrendsService(bookingTrendsRepo)
        bookingTrendsHandler := handler.NewBookingTrendsHandler(bookingTrendsService)

        pdfRepo := repository.NewPDFRepository(db)
        pdfService := &amp;service.PDFService{
                TripRepo:     pdfRepo,
                PDFGenerator: &amp;service.DefaultPDFGenerator{},
        }
        pdfHandler := handler.NewPDFHandler(pdfService)

        dashboardRepo := repository.NewDashboardRepository(db)
        dashboardService := service.NewDashboardService(dashboardRepo)
        dashboardHandler := handler.NewDashboardHandler(dashboardService)

        dashboardTripRepo := repository.NewDashboardTripRepository(db)
        dashboardTripService := service.NewDashboardTripService(dashboardTripRepo)
        dashboardTripHandler := handler.NewDashboardTripHandler(dashboardTripService)

        carTypeRepo := repository.NewCarTypeRepository(db)
        carModelRepo := repository.NewCarModelRepository(db)

        carTypeService := service.NewCarTypeService(carTypeRepo)
        carModelService := service.NewCarModelService(carModelRepo)

        carTypeHandler := handler.NewCarTypeHandler(carTypeService)
        carModelHandler := handler.NewCarModelRepositoryHandler(carModelService)

        r := gin.Default()
        r.Use(cors.New(cors.Config{
                AllowOrigins:     []string{"*"},
                AllowMethods:     []string{"GET", "POST", "PUT", "DELETE"},
                AllowHeaders:     []string{"Origin", "Content-Type", "Authorization"},
                ExposeHeaders:    []string{"Content-Length"},
                AllowCredentials: true,
                MaxAge:           12 * time.Hour,
        }))

        // REGISTER ROUTES
        r.POST("/login", authHandler.Login)
        r.POST("/refresh", authHandler.Refresh)

        r.GET("/drivers", driverHandler.GetAll)
        r.POST("/drivers", driverHandler.Create)
        r.GET("/drivers/:id", driverHandler.GetByID)
        r.PUT("/drivers/:id", driverHandler.Update)
        r.DELETE("/drivers/:id", driverHandler.Delete)

        r.POST("/booking", bookingHandler.Create)
        r.GET("/booking", bookingHandler.GetAll)
        r.DELETE("/booking/:id", bookingHandler.Delete)

        r.GET("/car", carHandler.GetAll)
        r.GET("/car/:id", carHandler.GetByID)
        r.POST("/car", carHandler.Create)
        r.PUT("/car/:id", carHandler.Update)
        r.DELETE("/car/:id", carHandler.Delete)

        r.GET("/payments", paymentHandler.GetPayments)
        r.GET("/paymentsStats", paymentHandler.GetPaymentStats)
        r.GET("/payments/:id", paymentHandler.GetPaymentByID)
        r.POST("/payments", paymentHandler.CreatePayment)
        r.PUT("/payments/:id", paymentHandler.UpdatePayment)
        r.DELETE("/payments/:id", paymentHandler.DeletePayment)

        r.GET("/assignments/:vehicle_id", assignmentHandler.FindByVehicle)
        r.POST("/assignments", assignmentHandler.Create)
        r.PUT("/assignments/:id", assignmentHandler.Update)
        r.DELETE("/assignments/:id", assignmentHandler.Delete)

        r.POST("/maintenance", maintenanceHandler.Create)
        r.GET("/maintenance/vehicle/:vehicle_id", maintenanceHandler.FindByVehicle)
        r.PUT("/maintenance/:id", maintenanceHandler.Update)
        r.DELETE("/maintenance/:id", maintenanceHandler.Delete)

        r.GET("/trips/vehicle/:vehicle_id", tripHandler.FindByVehicle)
        r.POST("/trips", tripHandler.Create)
        r.PUT("/trips/:id", tripHandler.Update)
        r.DELETE("/trips/:id", tripHandler.Delete)

        r.GET("/tripsStats", tripHandler.GetTripTotal)
        r.GET("/booking-trends", bookingTrendsHandler.GetTrends)
        r.GET("/trip-history", tripHistoryHandler.GetTripHistory)
        r.GET("/chart", popularHandler.GetAll)

        r.GET("/car-types", carTypeHandler.GetAll)
        r.GET("/car-models", carModelHandler.GetAll)
        r.GET("/car-models/:id", carModelHandler.GetByID)
        r.GET("/car-types/:id", carTypeHandler.GetByID)

        r.GET("/receipt/:trip_id", pdfHandler.HandlePDFReceipt)
        r.GET("/api/dashboard", dashboardHandler.GetDashboard)
        r.GET("/api/dashboardtrip/:id", dashboardTripHandler.GetDashboard)

        return r
}</span>
</pre>
		
		<pre class="file" id="file35" style="display: none">package service

import (
        "auth-service/model"
        "auth-service/repository"
)

type AssignmentsServiceInterface interface {
        Create(*model.DriverAssignment) error
        Update(*model.DriverAssignment) error
        Delete(uint) error
        FindByVehicle(uint) ([]model.DriverAssignment, error)
}

type AssignmentsService struct {
        Repo repository.AssignmentsRepositoryInterface
}

func NewAssignmentsService(repo repository.AssignmentsRepositoryInterface) *AssignmentsService <span class="cov8" title="1">{
        return &amp;AssignmentsService{Repo: repo}
}</span>

func (s *AssignmentsService) Create(a *model.DriverAssignment) error <span class="cov8" title="1">{
        return s.Repo.Create(a)
}</span>

func (s *AssignmentsService) FindByVehicle(vehicleID uint) ([]model.DriverAssignment, error) <span class="cov8" title="1">{
        return s.Repo.FindByVehicle(vehicleID)
}</span>

func (s *AssignmentsService) Update(a *model.DriverAssignment) error <span class="cov8" title="1">{
        return s.Repo.Update(a)
}</span>

func (s *AssignmentsService) Delete(id uint) error <span class="cov8" title="1">{
        return s.Repo.Delete(id)
}</span>
</pre>
		
		<pre class="file" id="file36" style="display: none">package service

import (
        "auth-service/model"
        "auth-service/repository"
        "time"

        "github.com/golang-jwt/jwt/v5"
        "golang.org/x/crypto/bcrypt"
)

var jwtKey = []byte("secret_key")
var refreshKey = []byte("refresh_secret_key")

type AuthService struct {
        Repo *repository.UserRepository
}

func (a *AuthService) Login(email string, password string) (any, any, any) <span class="cov0" title="0">{
        panic("unimplemented")</span>
}

func HashPassword(password string) (string, error) <span class="cov8" title="1">{
        bytes, err := bcrypt.GenerateFromPassword([]byte(password), 14)
        return string(bytes), err
}</span>

func CheckPasswordHash(password, hash string) bool <span class="cov8" title="1">{
        err := bcrypt.CompareHashAndPassword([]byte(hash), []byte(password))
        return err == nil
}</span>

func GenerateJWT(user model.User) (string, error) <span class="cov8" title="1">{
        claims := jwt.MapClaims{
                "user_id": user.ID,
                "exp":     time.Now().Add(time.Hour * 24).Unix(),
        }

        token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims)
        return token.SignedString(jwtKey)
}</span>

func GenerateRefreshToken(user model.User) (string, error) <span class="cov8" title="1">{
        claims := jwt.MapClaims{
                "user_id": user.ID,
                "exp":     time.Now().Add(time.Hour * 24 * 7).Unix(),
        }

        token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims)
        return token.SignedString(refreshKey)
}</span>
</pre>
		
		<pre class="file" id="file37" style="display: none">package service

import (
        "auth-service/model"
        "auth-service/repository"
)

type BookingServiceInterface interface {
        Create(*model.Booking) error
        GetAll() ([]model.Booking, error)
        Update(*model.Booking) error
        Delete(id string) error
}

type BookingService struct {
        Repo repository.BookingRepositoryInterface
}

func (s *BookingService) Create(b *model.Booking) error <span class="cov8" title="1">{
        return s.Repo.Create(b)
}</span>

func (s *BookingService) GetAll() ([]model.Booking, error) <span class="cov8" title="1">{
        return s.Repo.GetAll()
}</span>

func (s *BookingService) Update(b *model.Booking) error <span class="cov8" title="1">{
        return s.Repo.Update(b)
}</span>

func (s *BookingService) Delete(id string) error <span class="cov8" title="1">{
        return s.Repo.Delete(id)
}</span>
</pre>
		
		<pre class="file" id="file38" style="display: none">package service

import (
        "auth-service/model"
        "auth-service/repository"
)

type BookingTrendsService struct {
        Repo repository.BookingTrendsRepositoryInterface
}

func NewBookingTrendsService(repo repository.BookingTrendsRepositoryInterface) *BookingTrendsService <span class="cov8" title="1">{
        return &amp;BookingTrendsService{Repo: repo}
}</span>

func (s *BookingTrendsService) GetTrends(year int) ([]model.BookingTrend, error) <span class="cov8" title="1">{
        return s.Repo.GetTrends(year)
}</span>
</pre>
		
		<pre class="file" id="file39" style="display: none">package service

import (
        "auth-service/model"
        "auth-service/repository"
)

type CarModelService struct {
        repo repository.CarModelRepositoryInterface
}

func NewCarModelService(repo repository.CarModelRepositoryInterface) *CarModelService <span class="cov8" title="1">{
        return &amp;CarModelService{repo: repo}
}</span>

func (s *CarModelService) GetAll() ([]model.CarModel, error) <span class="cov8" title="1">{
        return s.repo.FindAll()
}</span>

func (s *CarModelService) GetByID(id int) (*model.CarModel, error) <span class="cov8" title="1">{
        return s.repo.GetByID(id)
}</span>

func (s *CarModelService) Create(cm model.CarModel) error <span class="cov8" title="1">{
        return s.repo.Create(&amp;cm)
}</span>
</pre>
		
		<pre class="file" id="file40" style="display: none">package service

import (
        "auth-service/model"
        "auth-service/repository"
)

type CarService struct {
        Repo repository.CarRepositoryInterface
}

func NewCarService(repo repository.CarRepositoryInterface) *CarService <span class="cov8" title="1">{
        return &amp;CarService{Repo: repo}
}</span>

func (s *CarService) GetAll() ([]model.Car, error) <span class="cov8" title="1">{
        return s.Repo.GetAll()
}</span>

func (s *CarService) GetByID(id int) (*model.Car, error) <span class="cov8" title="1">{
        return s.Repo.GetByID(id)
}</span>

func (s *CarService) Create(v model.Car) error <span class="cov8" title="1">{
        return s.Repo.Create(v)
}</span>

func (s *CarService) Update(id int, v model.Car) error <span class="cov8" title="1">{
        return s.Repo.Update(id, v)
}</span>

func (s *CarService) Delete(id int) error <span class="cov8" title="1">{
        return s.Repo.Delete(id)
}</span>
</pre>
		
		<pre class="file" id="file41" style="display: none">package service

import (
        "auth-service/model"
        "auth-service/repository"
)

type CarTypeService struct {
        Repo repository.CarTypeRepositoryInterface
}

func NewCarTypeService(repo repository.CarTypeRepositoryInterface) *CarTypeService <span class="cov8" title="1">{
        return &amp;CarTypeService{Repo: repo}
}</span>

func (s *CarTypeService) GetAll() ([]model.CarType, error) <span class="cov8" title="1">{
        return s.Repo.FindAll()
}</span>

func (s *CarTypeService) GetByID(id int) (*model.CarType, error) <span class="cov8" title="1">{
        return s.Repo.GetByID(id)
}</span>

func (s *CarTypeService) Create(ct model.CarType) error <span class="cov8" title="1">{
        return s.Repo.Create(ct)
}</span>
</pre>
		
		<pre class="file" id="file42" style="display: none">package service

import (
        "auth-service/model"
        "auth-service/repository"
)

type PopularDestinationService struct {
        Repo repository.PopularDestinationRepositoryInterface
}

type PopularDestinationServiceInterface interface {
        GetAll() ([]model.PopularDestination, error)
}

func (s *PopularDestinationService) GetAll() ([]model.PopularDestination, error) <span class="cov8" title="1">{
        return s.Repo.GetAll()
}</span>

func (s *PopularDestinationService) Add(destination string, bookings int) (*model.PopularDestination, error) <span class="cov8" title="1">{
        pd := model.PopularDestination{
                Destination: destination,
                Bookings:    bookings,
        }
        return s.Repo.Add(pd)
}</span>

func (s *PopularDestinationService) UpdateBookings(id int, bookings int) error <span class="cov8" title="1">{
        return s.Repo.UpdateBookings(id, bookings)
}</span>

func (s *PopularDestinationService) Delete(id int) error <span class="cov8" title="1">{
        return s.Repo.Delete(id)
}</span>
</pre>
		
		<pre class="file" id="file43" style="display: none">package service

import (
        "auth-service/model"
        "auth-service/repository"
        "context"
)

type DashboardTripServiceInterface interface {
        GetDashboardSummary(ctx context.Context) (*model.DashboardSummary, error)
}

type DashboardTripService struct {
        Repo repository.DashboardTripRepositoryInterface
}

func NewDashboardTripService(repo repository.DashboardTripRepositoryInterface) *DashboardTripService <span class="cov8" title="1">{
        return &amp;DashboardTripService{Repo: repo}
}</span>

func (s *DashboardTripService) GetDashboardSummary(ctx context.Context) (*model.DashboardSummary, error) <span class="cov8" title="1">{
        return s.Repo.GetDashboardSummary(ctx)
}</span>
</pre>
		
		<pre class="file" id="file44" style="display: none">package service

import "auth-service/repository"

type DashboardServiceInterface interface {
        GetDashboardData() (map[string]interface{}, error)
}

type DashboardService struct {
        repo repository.DashboardRepositoryInterface
}

func NewDashboardService(repo repository.DashboardRepositoryInterface) *DashboardService <span class="cov8" title="1">{
        return &amp;DashboardService{repo: repo}
}</span>

func (s *DashboardService) GetDashboardData() (map[string]interface{}, error) <span class="cov8" title="1">{
        bookings, err := s.repo.GetTotalBookings()
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov8" title="1">drivers, err := s.repo.GetActiveDrivers()
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov8" title="1">revenue, err := s.repo.GetTotalRevenue()
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov8" title="1">return map[string]interface{}{
                "totalBookings": bookings,
                "activeDrivers": drivers,
                "totalRevenue":  revenue,
        }, nil</span>
}
</pre>
		
		<pre class="file" id="file45" style="display: none">package service

import (
        "auth-service/model"
        "auth-service/repository"
)

type DriverService struct {
        Repo repository.DriverRepositoryInterface
}

func (s *DriverService) GetAll() ([]model.Driver, error) <span class="cov8" title="1">{
        return s.Repo.GetAll()
}</span>

func (s *DriverService) Create(driver *model.Driver) error <span class="cov8" title="1">{
        return s.Repo.Create(driver)
}</span>

func (s *DriverService) GetByID(id string) (*model.Driver, error) <span class="cov8" title="1">{
        return s.Repo.GetByID(id)
}</span>

func (s *DriverService) Update(id string, driver *model.Driver) error <span class="cov8" title="1">{
        return s.Repo.Update(id, driver)
}</span>

func (s *DriverService) Delete(id string) error <span class="cov8" title="1">{
        return s.Repo.Delete(id)
}</span>
</pre>
		
		<pre class="file" id="file46" style="display: none">package service

import (
        "auth-service/model"
        "auth-service/repository"
)

type MaintenanceServiceInterface interface {
        Create(*model.VehicleMaintenance) error
        FindByVehicle(vehicleID int) ([]model.VehicleMaintenance, error)
        Update(*model.VehicleMaintenance) error
        Delete(id uint) error
}

type MaintenanceService struct {
        Repo repository.MaintenanceRepositoryInterface
}

func NewMaintenanceService(repo repository.MaintenanceRepositoryInterface) *MaintenanceService <span class="cov8" title="1">{
        return &amp;MaintenanceService{Repo: repo}
}</span>

func (s *MaintenanceService) Create(m *model.VehicleMaintenance) error <span class="cov8" title="1">{
        return s.Repo.Create(m)
}</span>

func (s *MaintenanceService) FindByVehicle(vehicleID int) ([]model.VehicleMaintenance, error) <span class="cov8" title="1">{
        return s.Repo.FindByVehicle(vehicleID)
}</span>

func (s *MaintenanceService) Update(m *model.VehicleMaintenance) error <span class="cov8" title="1">{
        return s.Repo.Update(m)
}</span>

func (s *MaintenanceService) Delete(id uint) error <span class="cov8" title="1">{
        return s.Repo.Delete(id)
}</span>
</pre>
		
		<pre class="file" id="file47" style="display: none">package service

import (
        "auth-service/model"
        "auth-service/repository"
        "context"
)

type PaymentServiceInterface interface {
        GetPayments(page, pageSize int) ([]model.Payment, error)
        GetPaymentByID(ctx context.Context, id int) (*model.Payment, error)
        CreatePayment(ctx context.Context, p *model.Payment) (int, error)
        UpdatePayment(ctx context.Context, p *model.Payment) error
        DeletePayment(ctx context.Context, id int) error
        GetPaymentStats(ctx context.Context) (*model.PaymentStats, error)
}

type PaymentService struct {
        Repo repository.PaymentRepositoryInterface
}

func NewPaymentService(repo repository.PaymentRepositoryInterface) *PaymentService <span class="cov8" title="1">{
        return &amp;PaymentService{
                Repo: repo,
        }
}</span>

func (s *PaymentService) GetPayments(page, pageSize int) ([]model.Payment, error) <span class="cov8" title="1">{
        return s.Repo.GetPayments(page, pageSize)
}</span>

func (s *PaymentService) GetPaymentStats(ctx context.Context) (*model.PaymentStats, error) <span class="cov8" title="1">{
        return s.Repo.GetPaymentStats(ctx)
}</span>

func (s *PaymentService) GetAllPayments(ctx context.Context) ([]model.Payment, error) <span class="cov0" title="0">{
        return s.Repo.GetAll(ctx)
}</span>

func (s *PaymentService) GetPaymentByID(ctx context.Context, id int) (*model.Payment, error) <span class="cov8" title="1">{
        return s.Repo.GetByID(ctx, id)
}</span>

func (s *PaymentService) CreatePayment(ctx context.Context, payment *model.Payment) (int, error) <span class="cov8" title="1">{
        return s.Repo.Create(ctx, payment)
}</span>

func (s *PaymentService) UpdatePayment(ctx context.Context, p *model.Payment) error <span class="cov8" title="1">{
        return s.Repo.Update(ctx, p)
}</span>

func (s *PaymentService) DeletePayment(ctx context.Context, id int) error <span class="cov8" title="1">{
        return s.Repo.Delete(ctx, id)
}</span>
</pre>
		
		<pre class="file" id="file48" style="display: none">package service

import (
        "auth-service/model"
        "auth-service/repository"
        "context"
        "fmt"
        "net/url"

        "github.com/chromedp/cdproto/page"
        "github.com/chromedp/chromedp"
)

type PDFGenerator interface {
        GeneratePDF(html string) ([]byte, error)
}

type DefaultPDFGenerator struct{}

func (d *DefaultPDFGenerator) GeneratePDF(html string) ([]byte, error) <span class="cov0" title="0">{
        ctx, cancel := chromedp.NewContext(context.Background())
        defer cancel()

        var pdfBytes []byte

        err := chromedp.Run(ctx,
                chromedp.Navigate("data:text/html,"+url.PathEscape(html)),
                chromedp.ActionFunc(func(ctx context.Context) error </span><span class="cov0" title="0">{
                        var err error
                        pdfBytes, _, err = page.PrintToPDF().Do(ctx)
                        return err
                }</span>),
        )

        <span class="cov0" title="0">return pdfBytes, err</span>
}

type PDFServiceInterface interface {
        GenerateTripReceiptPDF(tripID string) ([]byte, string, error)
}

type TemplateRenderer interface {
        RenderPDFReceipt(data model.PDFTemplateData) (string, error)
}

type PDFService struct {
        TripRepo         repository.PDFRepositoryInterface
        PDFGenerator     PDFGenerator
        TemplateRenderer TemplateRenderer
}

func (s *PDFService) GenerateTripReceiptPDF(tripID string) ([]byte, string, error) <span class="cov8" title="1">{
        tripData, err := s.TripRepo.GetTripByID(tripID)
        if err != nil </span><span class="cov8" title="1">{
                return nil, "", fmt.Errorf("gagal mendapatkan data trip: %w", err)
        }</span>

        <span class="cov8" title="1">amountFormatted := fmt.Sprintf("%.0f", float64(tripData.Amount))

        html, err := s.TemplateRenderer.RenderPDFReceipt(model.PDFTemplateData{
                Pdf:             tripData,
                AmountFormatted: amountFormatted,
        })
        if err != nil </span><span class="cov8" title="1">{
                return nil, "", fmt.Errorf("gagal render template: %w", err)
        }</span>

        <span class="cov8" title="1">pdfBytes, err := s.PDFGenerator.GeneratePDF(html)
        if err != nil </span><span class="cov8" title="1">{
                return nil, "", fmt.Errorf("gagal generate PDF: %w", err)
        }</span>

        <span class="cov8" title="1">filename := fmt.Sprintf("receipt_%s.pdf", tripID)
        return pdfBytes, filename, nil</span>
}
</pre>
		
		<pre class="file" id="file49" style="display: none">package service

import (
        "auth-service/model"
        "auth-service/repository"
        "context"
)

type TripServiceInterface interface {
        Create(*model.VehicleTrip) error
        FindByVehicle(uint) ([]model.VehicleTrip, error)
        Update(*model.VehicleTrip) error
        Delete(uint) error
        GetTripTotals(context.Context) (*model.TotalTrips, error)
}

type TripService struct {
        repo repository.TripsRepositoryInterface
}

func NewTripService(repo repository.TripsRepositoryInterface) *TripService <span class="cov0" title="0">{
        return &amp;TripService{repo: repo}
}</span>

func (s *TripService) Create(t *model.VehicleTrip) error <span class="cov0" title="0">{
        return s.repo.Create(t)
}</span>

func (s *TripService) Update(t *model.VehicleTrip) error <span class="cov0" title="0">{
        return s.repo.Update(t)
}</span>

func (s *TripService) Delete(id uint) error <span class="cov0" title="0">{
        return s.repo.Delete(id)
}</span>

func (s *TripService) FindByVehicle(vehicleID uint) ([]model.VehicleTrip, error) <span class="cov0" title="0">{
        return s.repo.FindByVehicle(vehicleID)
}</span>

func (s *TripService) GetTripTotals(ctx context.Context) (*model.TotalTrips, error) <span class="cov0" title="0">{
        return s.repo.GetTripTotal(ctx)
}</span>
</pre>
		
		<pre class="file" id="file50" style="display: none">package service

import (
        "auth-service/model"
        "auth-service/repository"
)

type TripHistoryServiceInterface interface {
        Create(*model.DriverAssignment) error
        Update(*model.DriverAssignment) error
        Delete(uint) error
        FindByVehicle(uint) ([]model.DriverAssignment, error)
}

type TripHistoryMockService interface {
        GetTripHistory() ([]model.TripHistory, error)
}

type MockTripHistoryService struct {
        ReturnError bool
}

func (m *MockTripHistoryService) GetTripHistory() ([]model.TripHistory, error) <span class="cov0" title="0">{
        return []model.TripHistory{}, nil
}</span>

type TripHistoryService struct {
        Repo repository.TripHistoryRepositoryInterface
}

func NewTripHistoryService(repo repository.TripHistoryRepositoryInterface) *TripHistoryService <span class="cov8" title="1">{
        return &amp;TripHistoryService{Repo: repo}
}</span>

func (s *TripHistoryService) GetTripHistory() ([]model.TripHistory, error) <span class="cov8" title="1">{
        return s.Repo.GetTripHistory()
}</span>
</pre>
		
		</div>
	</body>
	<script>
	(function() {
		var files = document.getElementById('files');
		var visible;
		files.addEventListener('change', onChange, false);
		function select(part) {
			if (visible)
				visible.style.display = 'none';
			visible = document.getElementById(part);
			if (!visible)
				return;
			files.value = part;
			visible.style.display = 'block';
			location.hash = part;
		}
		function onChange() {
			select(files.value);
			window.scrollTo(0, 0);
		}
		if (location.hash != "") {
			select(location.hash.substr(1));
		}
		if (!visible) {
			select("file0");
		}
	})();
	</script>
</html>
